<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>RPM Packaging Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>RPM Packaging Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#welcome-to-rpm-packaging-guide-s-documentation">Welcome to RPM Packaging Guide’s documentation!</a>
<ul class="sectlevel2">
<li><a href="#so-you-want-to-be-an-rpm-packager">So You Want To Be An RPM Packager?</a></li>
<li><a href="#document-conventions">Document Conventions</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#contributing-to-this-guide">Contributing to this guide</a></li>
</ul>
</li>
<li><a href="#rpm-packaging-guide">RPM Packaging Guide</a>
<ul class="sectlevel2">
<li><a href="#rpm-packages">RPM Packages</a></li>
<li><a href="#building-rpms">Building RPMS</a></li>
<li><a href="#checking-rpms-for-sanity">Checking RPMs For Sanity</a></li>
</ul>
</li>
<li><a href="#general-topics-and-background">General Topics and Background</a>
<ul class="sectlevel2">
<li><a href="#what-is-source-code">What is Source Code?</a></li>
<li><a href="#how-programs-are-made">How Programs Are Made</a></li>
<li><a href="#building-software-from-source">Building Software from Source</a></li>
<li><a href="#patching-software">Patching Software</a></li>
<li><a href="#installing-arbitrary-artifacts">Installing Arbitrary Artifacts</a></li>
<li><a href="#prepping-our-example-upstream-source-code">Prepping our example upstream source code</a></li>
</ul>
</li>
<li><a href="#appendix">Appendix</a>
<ul class="sectlevel2">
<li><a href="#mock">Mock</a></li>
<li><a href="#version-control-systems">Version Control Systems</a></li>
<li><a href="#more-on-macros">More on Macros</a></li>
<li><a href="#advanced-spec-file-topics">Advanced SPEC File Topics</a></li>
<li><a href="#references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="welcome-to-rpm-packaging-guide-s-documentation">Welcome to RPM Packaging Guide’s documentation!</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="so-you-want-to-be-an-rpm-packager">So You Want To Be An RPM Packager?</h3>
<div class="paragraph">
<p>So you want to be an RPM Packager (or you at least need to know how to package
RPMs because of your dayjob or otherwise)?</p>
</div>
<div class="paragraph">
<p>Well hopefully this guide will prove to be helpful.</p>
</div>
<div class="paragraph">
<p>Below you will find information about RPMs, source code and all sorts of things
in between. If you are familiar with what <a href="https://en.wikipedia.org/wiki/Source_code">“Source Code”</a> is and how it gets
compiled or “built” into software then feel free to skip the <a href="#general-topics-and-background">General Topics and Background</a>
section and move right on into the
<a href="#rpm-packaging-guide">RPM Packaging Guide</a>. More advanced topics and items otherwise
considered out of scope of getting you on the path to packaging software will be
held in the <a href="#appendix">Appendix</a>. However, I hope all sections of this
guide do prove useful in some capacity.</p>
</div>
<div class="paragraph">
<p>This guide is meant to be used however the reader feels they would best like to
use it. The sections are arranged such that the reader may start from the
beginning and go all the way through and the flow of topics should make sense
with each topic building upon the previous ones. However, if you as the reader
feel you are comfortable with a topic or would just like to use the guide as
reference material please feel free to skip sections or jump around as you
please. The goal here is to be useful to someone with little to no background in
software development or packaging so some topics will likely seem oddly
introductory for such a guide, but don’t worry that’s by design and you can skip
past those if you like.</p>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions">Document Conventions</h3>
<div class="paragraph">
<p>Code and command line out put will be placed into a block similar to the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">This is a block! We can do all sorts of cool code and command line stuff
here!

Look, more lines!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ echo &quot;Here's some command line output!&quot;
Here's some command line output!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#!/usr/bin/env python</span>

<span class="keyword">def</span> <span class="function">code_example</span>:
    print(<span class="string"><span class="delimiter">&quot;</span><span class="content">And here's some code with syntax highlighting and everything!</span><span class="delimiter">&quot;</span></span>)

code_example()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Topics of interest or vocabulary terms will either be referred to as URLs to
their respective documentation/website, as a <strong>bold</strong> item, or in <em>italics</em>. The
first encounter of the term should be a reference to its respective
documentation.</p>
</div>
<div class="paragraph">
<p>Command line utilities, commands, or things otherwise found in code that are
used through out paragraphs will be written in a <code>monospace</code> font.</p>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>In order to perform the following examples you will need a few packages
installed on your system:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The inclusion of some of the packages below are not actually necessary
because they are a part of the default installation of Fedora, RHEL, and
CentOS but are listed explicitly for perspective of exactly the tools used
within this document.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>For <a href="https://getfedora.org/">Fedora</a>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ dnf install gcc rpm-build rpm-devel rpmlint make python bash coreutils diffutils
patch rpmdevtools</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>For <a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a> or <a href="https://www.centos.org/">CentOS</a> (this guide assumes version 7.x of either):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ yum install gcc rpm-build rpm-devel rpmlint make python bash coreutils diffutils
patch rpmdevtools</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beyond these preliminary packages you will also need a text editor of your
choosing. We will not be discussing or recommending text editors in this
document and we trust that everyone has at least one they are comfortable with
at their disposal.</p>
</div>
</div>
<div class="sect2">
<h3 id="contributing-to-this-guide">Contributing to this guide</h3>
<div class="paragraph">
<p>If you are currently a RPM Packager and would like to contribute either by way
of feedback or pull request, please do! Both forms of contribution are greatly
appreciate and certainly welcome. Feel free to file an issue ticket with
feedback, submit a pull request <a href="https://github.com/redhat-developer/rpm-packaging-guide">on GitHub</a>, or both!</p>
</div>
<div class="paragraph">
<p>Thank you for your time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rpm-packaging-guide">RPM Packaging Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hello! Welcome to RPM Packaging 101 (for lack of a more inventive title). Here
you will find all of the information you need in order to start packaging RPMs
for various <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> Distributions that use the <a href="http://rpm.org/">RPM</a> Packaging Format.</p>
</div>
<div class="paragraph">
<p>This guide assumes no previous knowledge about packaging software for any
Operating System, Linux or otherwise. However, it should be noted that this
guide is written to target the Red Hat “family” of Linux distributions, which
are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://getfedora.org/">Fedora</a></p>
</li>
<li>
<p><a href="https://www.centos.org/">CentOS</a></p>
</li>
<li>
<p><a href="https://www.redhat.com/en/technologies/linux-platforms">Red Hat Enterprise Linux</a> (often referred to as <a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a> for short)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While these distros are the target environment, it should be noted that lessons
learned here should be applicable across all distributions that are <a href="https://en.wikipedia.org/wiki/List_of_Linux_distributions#RPM-based">RPM based</a>
but the examples will need to be adapted for distribution specific items such as
prerequisite installation items, guidelines, or macros. (More on macros later)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you have made it this far and don’t know what a software package or a
GNU/Linux distribution is, you might be best served by exploring some
articles on the topics of <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> and <a href="https://en.wikipedia.org/wiki/Package_manager">Package Managers</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="rpm-packages">RPM Packages</h3>
<div class="paragraph">
<p>In this section we are going to hopefully cover everything you ever wanted to
know about the RPM Packaging format, and if not then hopefully the contents of
the <a href="#appendix">Appendix</a> will satisfy the craving for knowledge that has
been left out of this section.</p>
</div>
<div class="sect3">
<h4 id="what-is-an-rpm">What is an RPM?</h4>
<div class="paragraph">
<p>To kick things off, let’s first define what an RPM actually is. An RPM package
is simply a file that contains some files as well as information the system
needs to know about those files. More specifically, it is a file containing a
<a href="https://en.wikipedia.org/wiki/Cpio">cpio</a> archive and metadata about itself. The <a href="https://en.wikipedia.org/wiki/Cpio">cpio</a> archive is the payload
and the RPM Header contains the metadata. The package manager <code>rpm</code> uses this
metadata to determine things like dependencies, where to install files, etc.</p>
</div>
<div class="paragraph">
<p>Conventionally speaking there are two different types of RPM, there is the
Source RPM (SRPM) and the binary RPM. Both of these share a file format and
tooling, but they represent very different things. The payload of a SRPM is a
SPEC file (which describes how to build a binary RPM) and the actually source
code that the resulting binary RPM will be built out of (including any patches
that may be needed).</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-packaging-workspace">RPM Packaging Workspace</h4>
<div class="paragraph">
<p>In the <a href="#prerequisites">Prerequisites</a> section we installed a package named
<code>rpmdevtools</code> which provides a number of handy utilities for RPM Packagers.</p>
</div>
<div class="paragraph">
<p>Feel free to explore the output of the following command and check out the
various utilities manual pages or help dialogs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ql rpmdevtools | grep bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the sake of setting up our RPM Packaging workspace let’s use the
<code>rpmdev-setuptree</code> utility to create our directory layout. We will then define
what each directory in the directory structure is meant for.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmdev-setuptree

$ tree ~/rpmbuild/
/home/maxamillion/rpmbuild/
|-- BUILD
|-- RPMS
|-- SOURCES
|-- SPECS
`-- SRPMS

5 directories, 0 files</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUILD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Various <code>%buildroot</code> directories will be created here when
packages are built. This is useful for inspecting a
postmortem of a build that goes bad if the logs output don’t
provide enough information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary RPMs will land here in subdirectories of
Architecture. For example: <code>noarch</code> and <code>x86_64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOURCES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compressed source archives and any patches should go here,
this is where the <code>rpmbuild</code> command will look for them.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPECS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPEC files live here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SRPMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the correct arguments are passed to <code>rpmbuild</code> to
build a Source RPM instead of a Binary RPM, the Source RPMs
(SRPMS) will land in this directory.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="what-is-a-spec-file">What is a SPEC File?</h4>
<div class="paragraph">
<p>A SPEC file can be thought of the as the <strong>recipe</strong> that the <code>rpmbuild</code>
utility uses to actually build an RPM. It tells the build system what to do by
defining instructions in a series of sections. The sections are defined between
the <em>Preamble</em> and the <em>Body</em>. Within the <em>Preamble</em> we will define a series of
metadata items that will be used through out the <em>Body</em> and the <em>Body</em> is where
the bulk of the work is accomplished.</p>
</div>
<div class="sect4">
<h5 id="preamble-items">Preamble Items</h5>
<div class="paragraph">
<p>In the table below you will find the items that are used in RPM Spec files in
the Preamble section.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPEC Directive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The (base) name of the package, which should match the SPEC
file name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The upstream version number of the software.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Release</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial value should normally be 1%{?dist}, this value
should be incremented each new release of the package and
reset to 1 when a new <code>Version</code> of the software is built.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Summary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A brief, one-line summary of the package.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>License</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The license of the software being packaged. For packages
that are destined for community distributions such as
<a href="https://getfedora.org/">Fedora</a> this must be an Open Source License abiding by the
specific distribution’s Licensing Guidelines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>URL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full URL for more information about the program (most
often this is the upstream project website for the software
being packaged).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Source0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path or URL to the compressed archive of the upstream source
code (unpatched, patches are handled elsewhere). This is
ideally a listing of the upstream URL resting place and not
just a local copy of the source. If needed, more SourceX
directives can be added, incrementing the number each time
such as: Source1, Source2, Source3, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Patch0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the first patch to apply to the source code if
necessary. If needed, more PatchX directives can be added,
incrementing the number each time such as: Patch1, Patch2,
Patch3, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildArch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the package is not architecture dependent, i.e. written
entirely in an interpreted programming language, this should
be <code>BuildArch: noarch</code> otherwise it will automatically
inherit the Architecture of the machine it’s being built on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildRequires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma or whitespace separated list of packages required
for building
(compiling) the program. There can be multiple entries of
<code>BuildRequires</code> each on its own line in the SPEC file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Requires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma or whitespace separated list of packages required
by the software to run once installed. There can
be multiple entries of <code>Requires</code> each on its
own line in the SPEC file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExcludeArch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In the event a piece of software can not operate on a
specific processor architecture, you can exclude it here.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are three “special” directives listed above which are <code>Name</code>,
<code>Version</code>, and <code>Release</code> which are used to create the RPM package’s
filename. You will often see these referred to by other RPM Package Maintainers
and Systems Administrators as <strong>N-V-R</strong> or just simply <strong>NVR</strong> as RPM package
filenames are of <code>NAME-VERSION-RELEASE</code> format.</p>
</div>
<div class="paragraph">
<p>For example, if we were to query about a specific package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -q python
python-2.7.5-34.el7.x86_64</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>python</code> is our Package Name, <code>2.7.5</code> is our Version, and <code>34.el7</code> is
our Release. The final marker is <code>x86_64</code> and is our architecture, which is
not something we control as a RPM Packager (with the exception of <code>noarch</code>,
more on that later) but is a side effect of the <code>rpmbuild</code> build environment,
something we will cover in more detail later.</p>
</div>
</div>
<div class="sect4">
<h5 id="body-items">Body Items</h5>
<div class="paragraph">
<p>In the table below you will find the items that are used in RPM Spec files in
the body.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPEC Directive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A full description of the software packaged in the RPM, this
can consume multiple lines and be broken into paragraphs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%prep</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or series of commands to prepare the software
to be built. Example is to uncompress the archive in
<code>Source0</code>. This can contain shell script.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or series of commands used to actually perform the
build procedure (compile) of the software.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%install</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or series of commands used to actually install the
various artifacts into a resulting location in the FHS.
Something to note is that this is done within the relative
context of the <code>%buildroot</code> (more on that later).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or series of commands to “test” the software. This
is normally things such as unit tests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%files</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of files that will be installed in their final
resting place in the context of the target system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%changelog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A record of changes that have happened to the package
between different <code>Version</code> or <code>Release</code> builds.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="advanced-items">Advanced items</h5>
<div class="paragraph">
<p>There are a series of advanced items including what are known as <em>scriptlets</em>
and <em>triggers</em> which take effect at different points through out the
installation process on the target machine (not the build process). These are
out of the scope of this document, but there is plenty of information on them in
the <a href="#appendix">Appendix</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="buildroots">BuildRoots</h4>
<div class="paragraph">
<p>The term “buildroot” is unfortunately ambiguous and you will often get various
different definitions. However in the world of RPM Packages this is literally
a <a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> environment such that you are creating a filesystem hierarchy in
a new “fake” root directory much in the way these contents can be laid down upon
an actual system’s filesystem and not violate it’s integrity. Imagine this much
in the same way that you would imagine creating the contents for a <a href="https://en.wikipedia.org/wiki/Tar_%28computing%29">tarball</a>
such that it would be expanded at the root (/) directory of an existing system
as this is effectively what RPM will do at a certain point during an
installation transaction. Ultimately the payload of the resulting Binary RPM is
extracted from this environment and put into the <a href="https://en.wikipedia.org/wiki/Cpio">cpio</a> archive.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-macros">RPM Macros</h4>
<div class="paragraph">
<p>A <a href="http://rpm.org/wiki/PackagerDocs/Macros">rpm macro</a> is a straight text substitution that can be conditionally assigned
based on the optional evaluation of a statement when certain built-in
functionality is used. What this means is that we can have RPM perform text
substitutions for us so that we don’t have to.</p>
</div>
<div class="paragraph">
<p>An example of how this can be extremely useful for a RPM Packager is if we
wanted to reference the <em>Version</em> of the software we are packaging multiple
times through out our SPEC file but only want to define it one time. We would
then use the <code>%{version}</code> macro and it would be substituted in place by
whatever the actual version number is that was entered in the <em>Version</em> field of
the SPEC.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>One handy utility of the <code>rpm</code> command for packagers is the <code>--eval</code>
flag which allows you to ask rpm to evaluate a macro. If you see a macro in
a SPEC file that you’re not familiar with, you can quickly evaluate the
expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --eval %{_bindir}
/usr/bin

$ rpm --eval %{_libexecdir}
/usr/libexec</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A common macro we will encounter as a packager is <code>%{?dist}</code> which signifies
the “distribution tag” allowing for a short textual representation of the
distribution used for the build to be injected into a text field.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># On a RHEL 7.x machine
$ rpm --eval %{?dist}
.el7

# On a Fedora 23 machine
$ rpm --eval %{?dist}
.fc23</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, please reference the <a href="#more-on-macros">More on Macros</a>
section of the <a href="#appendix">Appendix</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="working-with-spec-files">Working with SPEC files</h4>
<div class="paragraph">
<p>As a RPM Packager, you will likely spend a large majority of your time, when
packaging software, editing the SPEC file. The spec file is the recipe we use to tell
<code>rpmbuild</code> how to actually perform a build. In this section we will discuss
how to create and modify a spec file.</p>
</div>
<div class="paragraph">
<p>When it comes time to package new software, a new SPEC file must be created.
We <em>could</em> write one from scratch from memory but that sounds boring
and tedious, so let’s not do that. The good news is that we’re in luck and
there’s an utility called <code>rpmdev-newspec</code>. This utility will create a new spec file for us. We
will just fill in the various directives or add new fields as needed. This
provides us with a nice baseline template.</p>
</div>
<div class="paragraph">
<p>If you have not already done so by way of another section of the guide, go ahead
and download the example programs now and place them in your
<code>~/rpmbuild/SOURCES</code> directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/bello-0.1.tar.gz">bello-0.1.tar.gz</a></p>
</li>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/pello-0.1.1.tar.gz">pello-0.1.1.tar.gz</a></p>
</li>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/cello-1.0.tar.gz">cello-1.0.tar.gz</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/master/example-code/cello-output-first-patch.patch">cello-output-first-patch.patch</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s go ahead and create a SPEC file for each of our three implementations of
our example and then we will look at the SPEC files and the</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some programmer focused text editors will pre-populate a new file with the
extension <code>.spec</code> with a SPEC template of their own but <code>rpmdev-newspec</code>
is an editor-agnostic method which is why it is chosen here.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~/rpmbuild/SPECS

$ rpmdev-newspec bello
bello.spec created; type minimal, rpm version &gt;= 4.11.

$ rpmdev-newspec cello
cello.spec created; type minimal, rpm version &gt;= 4.11.

$ rpmdev-newspec pello
pello.spec created; type minimal, rpm version &gt;= 4.11.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will now find three SPEC files in your <code>~/rpmbuild/SPECS/</code> directory all
matching the names you passed to <code>rpmdev-newspec</code> but with the <code>.spec</code> file
extension. Take a moment to look at the files using your favorite text editor,
the directives should look familiar from the
<a href="#what-is-a-spec-file">What is a SPEC File?</a> section. We will discuss the
exact information we will input into these fields in the following sections that
will focus specifically on each example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>rpmdev-newspec</code> utility does not use <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> Distribution specific
guidelines or conventions, however this document is targeted towards using
conventions and guidelines for <a href="https://getfedora.org/">Fedora</a>, <a href="https://www.centos.org/">CentOS</a>, and <a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a> so you will
notice:</p>
</div>
<div class="paragraph">
<p>We remove the use of <code>rm $RPM_BUILD_ROOT</code> as it is no longer necessary to
perform that task when building on <a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a> or <em>CentOS</em> 7.0 or newer or on
<a href="https://getfedora.org/">Fedora</a> version 18 or newer.</p>
</div>
<div class="paragraph">
<p>We also will favor the use of <code>%{buildroot}</code> notation over
<code>$RPM_BUILD_ROOT</code> when referencing RPM’s Buildroot for consistency with
all other defined or provided macros through out the SPEC</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are three examples below, each one is meant to be self-sufficient in
instruction such that you can jump to a specific one if it matches your needs
for packaging. However, feel free to read them straight through for a full
exploration of packaging different kinds of software.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explanation of example</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software written in a raw interpreted programming language
does doesn’t require a build but only needs files installed.
If a pre-compiled binary needs to be packaged, this method
could also be used since the binary would also just be
a file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software written in a byte-compiled interpreted programming
language used to demonstrate the installation of a byte
compile process and the installation of the resulting
pre-optimized files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software written in a natively compiled programming language
to demonstrate an common build and installation process
using tooling for compiling native code.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="bello-working-with-spec-files">bello</h5>
<div class="paragraph">
<p>Our first SPEC file will be for our example written in <a href="https://www.gnu.org/software/bash/">bash</a> shell script that
you downloaded (or you created a simulated upstream release in the <a href="#general-topics-and-background">General Topics and Background</a>
section) and placed its source code
into <code>~/rpmbuild/SOURCES/</code> earlier. Let’s go ahead and open the file
<code>~/rpmbuild/SPECS/bello.spec</code> and start filling in some fields.</p>
</div>
<div class="paragraph">
<p>The following is the output template we were given from <code>rpmdev-newspec</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let us begin with the first set of directives that <code>rpmdev-newspec</code> has
grouped together at the top of the file: <code>Name</code>, <code>Version</code>, <code>Release</code>,
<code>Summary</code>. The <code>Name</code> is already specified because we provided that
information to the command line for <code>rpmdev-newspec</code>.</p>
</div>
<div class="paragraph">
<p>Let’s set the <code>Version</code> to match what the “upstream” release version of the
<em>bello</em> source code is, which we can observe is <code>0.1</code> as set by the example
code we downloaded (or we created in the <a href="#general-topics-and-background">General Topics and Background</a> section).</p>
</div>
<div class="paragraph">
<p>The <code>Release</code> is already set to <code>1%{?dist}</code> for us, the numerical value
which is initially <code>1</code> should be incremented every time the package is updated
for any reason, such as including a new patch to fix an issue, but doesn’t have
a new upstream release <code>Version</code>. When a new upstream release happens (for
example, bello version <code>0.2</code> were released) then the <code>Release</code> number should
be reset to <code>1</code>. The <em>disttag</em> of <code>%{?dist}</code> should look familiar from the
previous section’s coverage of <a href="#rpm-macros">RPM Macros</a>.</p>
</div>
<div class="paragraph">
<p>The <code>Summary</code> should be a short, one-line explanation of what this software
is.</p>
</div>
<div class="paragraph">
<p>After your edits, the first section of the SPEC file should resemble the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let’s move on to the second set of directives that <code>rpmdev-newspec</code> has
grouped together in our SPEC file: <code>License</code>, <code>URL</code>, <code>Source0</code>.</p>
</div>
<div class="paragraph">
<p>The <code>License</code> field is the <a href="https://en.wikipedia.org/wiki/Software_license">Software License</a> associated with the source code
from the upstream release. The exact format for how to label the License in your
SPEC file will vary depending on which specific RPM based <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> distribution
guidelines you are following, we will use the notation standards in the <a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora
License Guidelines</a> for this document and as such this field will contain the
text <code>GPLv3+</code></p>
</div>
<div class="paragraph">
<p>The <code>URL</code> field is the upstream software’s website, not the source code
download link but the actual project, product, or company website where someone
would find more information about this particular piece of software. Since we’re
just using an example, we will call this <code><a href="https://example.com/bello" class="bare">https://example.com/bello</a></code>. However,
we will use the rpm macro variable of <code>%{name}</code> in it’s place for consistency
and the resulting entry will be <code><a href="https://example.com/%{name}" class="bare">https://example.com/%{name}</a></code>.</p>
</div>
<div class="paragraph">
<p>The <code>Source0</code> field is where the upstream software’s source code should be
able to be downloaded from. This URL should link directly to the specific
version of the source code release that this RPM Package is packaging. Once
again, since this is an example we will use an example value:
<code><a href="https://example.com/bello/releases/bello-0.1.tar.gz" class="bare">https://example.com/bello/releases/bello-0.1.tar.gz</a></code> and while we might want
to, we should note that this example URL has hard coded values in it that are
possible to change in the future and are potentially even likely to change such
as the release version <code>0.1</code>. We can simplify this by only needing to update
one field in the SPEC file and allowing it to be reused. we will use the value
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code> instead of
the hard coded examples string previously listed.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up we have <code>BuildRequires</code> and <code>Requires</code>, each of which define
something that is required by the package. However, <code>BuildRequires</code> is to tell
<code>rpmbuild</code> what is needed by your package at <strong>build</strong> time and <code>Requires</code>
is what is needed by your package at <strong>run</strong> time. In this example there is no
<strong>build</strong> because the <a href="https://www.gnu.org/software/bash/">bash</a> script is a raw interpreted programming language
so we will only be installing files into locations on the system, but it does
require the <a href="https://www.gnu.org/software/bash/">bash</a> shell environment in order to execute so we will need to
define <code>bash</code> as a requirement using the <code>Requires</code> directive.</p>
</div>
<div class="paragraph">
<p>Since we don’t have a build step, we can simply omit the <code>BuildRequires</code>
directive. There is no need to define is as “undefined” or otherwise, omitting
it’s inclusion will suffice.</p>
</div>
<div class="paragraph">
<p>Something we need to add here since this is software written in an interpreted
programming language with no natively compiled extensions is a <code>BuildArch</code>
entry that is set to <code>noarch</code> in order to tell RPM that this package does not
need to be bound to the processor architecture that it is built using.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

Requires:       bash

BuildArch:      noarch</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following directives can be thought of as “section headings” because they
are directives that can define multi-line, multi-instruction, or scripted tasks
to occur. We will walk through them one by one just as we did with the previous
items.</p>
</div>
<div class="paragraph">
<p>The <code>%description</code> should be a longer, more full length description of the
software being packaged than what is found in the <code>Summary</code> directive. For the
sake of our example, this isn’t really going to contain much content but this
section can be a full paragraph or more than one paragraph if desired.</p>
</div>
<div class="paragraph">
<p>The <code>%prep</code> section is where we <em>prepare</em> our build environment or workspace
for building. Most often what happens here is the expansion of compressed
archives of the source code, application of patches, and potentially parsing of
information provided in the source code that is necessary in a later portion of
the SPEC. In this section we will simply use the provided macro <code>%setup -q</code>.</p>
</div>
<div class="paragraph">
<p>The <code>%build</code> section is where we tell the system how to actually build the
software we are packaging. However, since this software doesn’t need to be built
we can simply leave this section blank (removing what was provided by the
template).</p>
</div>
<div class="paragraph">
<p>The <code>%install</code> section is where we instruct <code>rpmbuild</code> how to install our
previously built software (in the event of a build process) into the
<code>BUILDROOT</code> which is effectively a <a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> base directory with nothing in it
and we will have to construct any paths or directory hierarchies that we will
need in order to install our software here in their specific locations. However,
our RPM Macros help us accomplish this task without having to hardcode paths.
Since the only thing we need to do in order to install <code>bello</code> into this
environment is create the destination directory for the executable <a href="https://www.gnu.org/software/bash/">bash</a>
script file and then install the file into that directory, we can do so by using
the same <code>install</code> command but we will make a slight modification since we are
inside the SPEC file and we will use the macro variable of <code>%{name}</code> in it’s
place for consistency.</p>
</div>
<div class="paragraph">
<p>The <code>%install</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install

mkdir -p %{buildroot}/%{_bindir}

install -m 0755 %{name} %{buildroot}/%{_bindir}/%{name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%files</code> section is where we provide the list of files that this RPM
provides and where it’s intended for them to live on the system that the RPM is
installed upon. Note here that this isn’t relative to the <code>%{buildroot}</code> but
the full path for the files as they are expected to exist on the end system
after installation. Therefore, the listing for the <code>bello</code> file we are
installing will be <code>%{_bindir}/%{name}</code> (this would be <code>/usr/bin/bello</code> if
we weren’t using the rpm macros).</p>
</div>
<div class="paragraph">
<p>Also within this section, you will sometimes need a built-in macro to provide
context on a file. This can be useful for Systems Administrators and end users
who might want to query the system with <code>rpm</code> about the resulting package.
The built-in macro we will use here is <code>%license</code> which will tell <code>rpmbuild</code>
that this is a software license file in the package file manifest metadata.</p>
</div>
<div class="paragraph">
<p>The <code>%files</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%{_bindir}/%{name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last section, <code>%changelog</code> is a list of date-stamped entries that
correlate to a specific Version-Release of the package. This is not meant to be
a log of what changed in the software from release to release, but specifically
to packaging changes. For example, if software in a package needed patching or
there was a change needed in the build procedure listed in the <code>%build</code>
section that information would go here. Each change entry can contain multiple
items and each item should start on a new line and begin with a <code>-</code> character.
Below is our example entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First bello package
- Example second item in the changelog for version-release 0.1-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the format above, the date-stamp will begin with a <code>*</code> character,
followed by the calendar day of the week, the month, the day of the month, the
year, then the contact information for the RPM Packager. From there we have
a <code>-</code> character before the Version-Release, which is an often used convention
but not a requirement. Then finally the Version-Release.</p>
</div>
<div class="paragraph">
<p>That’s it! We’ve written an entire SPEC file for <strong>bello</strong>! In the next section
we will cover how to build the RPM!</p>
</div>
<div class="paragraph">
<p>The full SPEC file should now look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

Requires:       bash

BuildArch:      noarch

%description
The long-tail description for our Hello World Example implemented in
bash script

%prep
%setup -q

%build

%install

mkdir -p %{buildroot}/%{_bindir}

install -m 0755 %{name} %{buildroot}/%{_bindir}/%{name}

%files
%license LICENSE
%{_bindir}/%{name}

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First bello package
- Example second item in the changelog for version-release 0.1-1</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="pello-working-with-spec-files">pello</h5>
<div class="paragraph">
<p>Our second SPEC file will be for our example written in the <a href="https://www.python.org/">Python</a>
programming language that  you downloaded (or you created a simulated upstream
release in the <a href="#general-topics-and-background">General Topics and Background</a>
section) and placed it’s source code into <code>~/rpmbuild/SOURCES/</code>
earlier. Let’s go ahead and open the file <code>~/rpmbuild/SPECS/bello.spec</code>
and start filling in some fields.</p>
</div>
<div class="paragraph">
<p>Before we start down this path, we need to address something somewhat unique
about byte-compiled interpreted software. Since we we will be byte-compiling
this program, the <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a> is no longer applicable because the resulting file
will not contain the entry. It is common practice to either have a
non-byte-compiled shell script that will call the executable or have a small
bit of the <a href="https://www.python.org/">Python</a> code that isn’t byte-compiled as the “entry point” into
the program’s execution. This might seem silly for our small example but for
large software projects with many thousands of lines of code, the performance
increase of pre-byte-compiled code is sizeable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The creation of a script to call the byte-compiled code or having
a non-byte-compiled entry point into the software is something that upstream
software developers most often address before doing a release of their
software to the world, however this is not always the case and this exercise
is meant to help address what to do in those situations. For more
information on how <a href="https://www.python.org/">Python</a> code is normally released and distributed
please reference the <a href="https://docs.python.org/2/library/distribution.html">Software Packaging and Distribution</a> documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will make a small shell script to call our byte compiled code to be the entry
point into our software. We will do this as a part of our SPEC file itself in
order to demonstrate how you can script actions inside the SPEC file. We will
cover the specifics of this in the <code>%install</code> section later.</p>
</div>
<div class="paragraph">
<p>Let’s go ahead and open the file <code>~/rpmbuild/SPECS/pello.spec</code> and start
filling in some fields.</p>
</div>
<div class="paragraph">
<p>The following is the output template we were given from <code>rpmdev-newspec</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as with the first example, let’s begin with the first set of directives
that <code>rpmdev-newspec</code> has grouped together at the top of the file:
<code>Name</code>, <code>Version</code>, <code>Release</code>, <code>Summary</code>. The <code>Name</code> is already
specified because we provided that information to the command line for
<code>rpmdev-newspec</code>.</p>
</div>
<div class="paragraph">
<p>Let’s set the <code>Version</code> to match what the “upstream” release version of the
<em>pello</em> source code is, which we can observe is <code>0.1.1</code> as set by the example
code we downloaded (or we created in the <a href="#general-topics-and-background">General Topics and Background</a> section).</p>
</div>
<div class="paragraph">
<p>The <code>Release</code> is already set to <code>1%{?dist}</code> for us, the numerical value
which is initially <code>1</code> should be incremented every time the package is updated
for any reason, such as including a new patch to fix an issue, but doesn’t have
a new upstream release <code>Version</code>. When a new upstream release happens (for
example, pello version <code>0.1.2</code> were released) then the <code>Release</code> number
should be reset to <code>1</code>. The <em>disttag</em> of <code>%{?dist}</code> should look familiar
from the previous section’s coverage of <a href="#rpm-macros">RPM Macros</a>.</p>
</div>
<div class="paragraph">
<p>The <code>Summary</code> should be a short, one-line explanation of what this software
is.</p>
</div>
<div class="paragraph">
<p>After your edits, the first section of the SPEC file should resemble the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let’s move on to the second set of directives that <code>rpmdev-newspec</code> has
grouped together in our SPEC file: <code>License</code>, <code>URL</code>, <code>Source0</code>.</p>
</div>
<div class="paragraph">
<p>The <code>License</code> field is the <a href="https://en.wikipedia.org/wiki/Software_license">Software License</a> associated with the source code
from the upstream release. The exact format for how to label the License in your
SPEC file will vary depending on which specific RPM based <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> distribution
guidelines you are following, we will use the notation standards in the <a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora
License Guidelines</a> for this document and as such this field will contain the
text <code>GPLv3+</code></p>
</div>
<div class="paragraph">
<p>The <code>URL</code> field is the upstream software’s website, not the source code
download link but the actual project, product, or company website where someone
would find more information about this particular piece of software. Since we’re
just using an example, we will call this <code><a href="https://example.com/pello" class="bare">https://example.com/pello</a></code>. However,
we will use the rpm macro variable of <code>%{name}</code> in it’s place for consistency.</p>
</div>
<div class="paragraph">
<p>The <code>Source0</code> field is where the upstream software’s source code should be
able to be downloaded from. This URL should link directly to the specific
version of the source code release that this RPM Package is packaging. Once
again, since this is an example we will use an example value:
<code><a href="https://example.com/pello/releases/pello-0.1.1.tar.gz" class="bare">https://example.com/pello/releases/pello-0.1.1.tar.gz</a></code></p>
</div>
<div class="paragraph">
<p>We should note that this example URL has hard coded values in it that are
possible to change in the future and are potentially even likely to change such
as the release version <code>0.1.1</code>. We can simplify this by only needing to update
one field in the SPEC file and allowing it to be reused. we will use the value
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code> instead of
the hard coded examples string previously listed.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up we have <code>BuildRequires</code> and <code>Requires</code>, each of which define
something that is required by the package. However, <code>BuildRequires</code> is to tell
<code>rpmbuild</code> what is needed by your package at <strong>build</strong> time and <code>Requires</code>
is what is needed by your package at <strong>run</strong> time.</p>
</div>
<div class="paragraph">
<p>In this example we will need the <code>python</code> package in order to perform the
byte-compile build process. We will also need the <code>python</code> package in order to
execute the byte-compiled code at runtime and therefore need to define
<code>python</code> as a requirement using the <code>Requires</code> directive. We will also need
the <code>bash</code> package in order to execute the small entry-point script we will
use here.</p>
</div>
<div class="paragraph">
<p>Something we need to add here since this is software written in an interpreted
programming language with no natively compiled extensions is a <code>BuildArch</code>
entry that is set to <code>noarch</code> in order to tell RPM that this package does not
need to be bound to the processor architecture that it is built using.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

BuildRequires:  python
Requires:       python
Requires:       bash

BuildArch:      noarch</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following directives can be thought of as “section headings” because they
are directives that can define multi-line, multi-instruction, or scripted tasks
to occur. We will walk through them one by one just as we did with the previous
items.</p>
</div>
<div class="paragraph">
<p>The <code>%description</code> should be a longer, more full length description of the
software being packaged than what is found in the <code>Summary</code> directive. For the
sake of our example, this isn’t really going to contain much content but this
section can be a full paragraph or more than one paragraph if desired.</p>
</div>
<div class="paragraph">
<p>The <code>%prep</code> section is where we <em>prepare</em> our build environment or workspace
for building. Most often what happens here is the expansion of compressed
archives of the source code, application of patches, and potentially parsing of
information provided in the source code that is necessary in a later portion of
the SPEC. In this section we will simply use the provided macro <code>%setup -q</code>.</p>
</div>
<div class="paragraph">
<p>The <code>%build</code> section is where we tell the system how to actually build the
software we are packaging. Here we will perform a byte-compilation of our
software. For those who read the <a href="#general-topics-and-background">General Topics and Background</a> section, this portion of the example should look familiar.
The <code>%build</code> section of our SPEC file should look as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%build

python -m compileall pello.py</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%install</code> section is where we instruct <code>rpmbuild</code> how to install our
previously built software into the <code>BUILDROOT</code> which is effectively a
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> base directory with nothing in it and we will have to construct any
paths or directory hierarchies that we will need in order to install our
software here in their specific locations. However, our RPM Macros help us
accomplish this task without having to hardcode paths.</p>
</div>
<div class="paragraph">
<p>We had previously discussed that since we will lose the context of a file with
the <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a> line in it when we byte compile that we will need to create
a simple wrapper script in order to accomplish that task. There are many options
on how to accomplish this including, but not limited to, making a separate
script and using that as a separate <code>SourceX</code> directive and the option we’re
going to show in this example which is to create the file in-line in the SPEC
file. The reason for showing the example option that we are is simply to
demonstrate that the SPEC file itself is scriptable. What we’re going to do is
create a small “wrapper script” which will execute the <a href="https://www.python.org/">Python</a> byte-compiled
code by using a <a href="https://en.wikipedia.org/wiki/Here_document">here document</a>. We will also need to actually install the
byte-compiled file into a library directory on the system such that it can be
accessed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will notice below that we are hard coding the library path. There are
various methods to avoid needing to do this, many of which are addressed in
the <a href="#appendix">Appendix</a>, under the <a href="#more-on-macros">More on Macros</a> section, and are specific to the programming language in
which the software that is being packaged was written in. In this example we
hard code the path for simplicity as to not cover too many topics
simultaneously.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>%install</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install

mkdir -p %{buildroot}/%{_bindir}
mkdir -p %{buildroot}/usr/lib/%{name}

cat &gt; %{buildroot}/%{_bindir}/%{name} &lt;&lt;-EOF
#!/bin/bash
/usr/bin/python /usr/lib/%{name}/%{name}.pyc
EOF

chmod 0755 %{buildroot}/%{_bindir}/%{name}

install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%files</code> section is where we provide the list of files that this RPM
provides and where it’s intended for them to live on the system that the RPM is
installed upon. Note here that this isn’t relative to the <code>%{buildroot}</code> but
the full path for the files as they are expected to exist on the end system
after installation. Therefore, the listing for the <code>pello</code> file we are
installing will be <code>%{_bindir}/pello</code>. We will also need to provide a <code>%dir</code>
listing to define that this package “owns” the library directory we created as
well as all the files we placed in it.</p>
</div>
<div class="paragraph">
<p>Also within this section, you will sometimes need a built-in macro to provide
context on a file. This can be useful for Systems Administrators and end users
who might want to query the system with <code>rpm</code> about the resulting package.
The built-in macro we will use here is <code>%license</code> which will tell <code>rpmbuild</code>
that this is a software license file in the package file manifest metadata.</p>
</div>
<div class="paragraph">
<p>The <code>%files</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%dir /usr/lib/%{name}/
%{_bindir}/%{name}
/usr/lib/%{name}/%{name}.py*</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last section, <code>%changelog</code> is a list of date-stamped entries that
correlate to a specific Version-Release of the package. This is not meant to be
a log of what changed in the software from release to release, but specifically
to packaging changes. For example, if software in a package needed patching or
there was a change needed in the build procedure listed in the <code>%build</code>
section that information would go here. Each change entry can contain multiple
items and each item should start on a new line and begin with a <code>-</code> character.
Below is our example entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First bello package
- Example second item in the changelog for version-release 0.1-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the format above, the date-stamp will begin with a <code>*</code> character,
followed by the calendar day of the week, the month, the day of the month, the
year, then the contact information for the RPM Packager. From there we have
a <code>-</code> character before the Version-Release, which is an often used convention
but not a requirement. Then finally the Version-Release.</p>
</div>
<div class="paragraph">
<p>That’s it! We’ve written an entire SPEC file for <strong>pello</strong>! In the next section
we will cover how to build the RPM!</p>
</div>
<div class="paragraph">
<p>The full SPEC file should now look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

BuildRequires:  python
Requires:       python
Requires:       bash

BuildArch:      noarch

%description
The long-tail description for our Hello World Example implemented in
Python

%prep
%setup -q

%build

python -m compileall %{name}.py

%install

mkdir -p %{buildroot}/%{_bindir}
mkdir -p %{buildroot}/usr/lib/%{name}

cat &gt; %{buildroot}/%{_bindir}/%{name} &lt;&lt;-EOF
#!/bin/bash
/usr/bin/python /usr/lib/%{name}/%{name}.pyc
EOF

chmod 0755 %{buildroot}/%{_bindir}/%{name}

install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/

%files
%license LICENSE
%dir /usr/lib/%{name}/
%{_bindir}/%{name}
/usr/lib/%{name}/%{name}.py*

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1.1-1
  - First pello package</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cello-working-with-spec-files">cello</h5>
<div class="paragraph">
<p>Our third SPEC file will be for our example written in the <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> programming
language that we created a simulated upstream release of previously (or you
downloaded) and placed it’s source code into <code>~/rpmbuild/SOURCES/</code> earlier.</p>
</div>
<div class="paragraph">
<p>Let’s go ahead and open the file <code>~/rpmbuild/SPECS/cello.spec</code> and start
filling in some fields.</p>
</div>
<div class="paragraph">
<p>The following is the output template we were given from <code>rpmdev-newspec</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as with the previous examples, let’s begin with the first set of directives
that <code>rpmdev-newspec</code> has grouped together at the top of the file:
<code>Name</code>, <code>Version</code>, <code>Release</code>, <code>Summary</code>. The <code>Name</code> is already
specified because we provided that information to the command line for
<code>rpmdev-newspec</code>.</p>
</div>
<div class="paragraph">
<p>Let’s set the <code>Version</code> to match what the “upstream” release version of the
<em>cello</em> source code is, which we can observe is <code>1.0</code> as set by the example
code we downloaded (or we created in the <a href="#general-topics-and-background">General Topics and Background</a> section).</p>
</div>
<div class="paragraph">
<p>The <code>Release</code> is already set to <code>1%{?dist}</code> for us, the numerical value
which is initially <code>1</code> should be incremented every time the package is updated
for any reason, such as including a new patch to fix an issue, but doesn’t have
a new upstream release <code>Version</code>. When a new upstream release happens (for
example, cello version <code>2.0</code> were released) then the <code>Release</code> number should
be reset to <code>1</code>. The <em>disttag</em> of <code>%{?dist}</code> should look familiar from the
previous section’s coverage of <a href="#rpm-macros">RPM Macros</a>.</p>
</div>
<div class="paragraph">
<p>The <code>Summary</code> should be a short, one-line explanation of what this software
is.</p>
</div>
<div class="paragraph">
<p>After your edits, the first section of the SPEC file should resemble the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let’s move on to the second set of directives that <code>rpmdev-newspec</code> has
grouped together in our SPEC file: <code>License</code>, <code>URL</code>, <code>Source0</code>. However,
we will add one to this grouping as it is closely related to the <code>Source0</code> and
that is our <code>Patch0</code> which will list the first patch we need against our
software.</p>
</div>
<div class="paragraph">
<p>The <code>License</code> field is the <a href="https://en.wikipedia.org/wiki/Software_license">Software License</a> associated with the source code
from the upstream release. The exact format for how to label the License in your
SPEC file will vary depending on which specific RPM based <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> distribution
guidelines you are following, we will use the notation standards in the <a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora
License Guidelines</a> for this document and as such this field will contain the
text <code>GPLv3+</code></p>
</div>
<div class="paragraph">
<p>The <code>URL</code> field is the upstream software’s website, not the source code
download link but the actual project, product, or company website where someone
would find more information about this particular piece of software. Since we’re
just using an example, we will call this <code><a href="https://example.com/cello" class="bare">https://example.com/cello</a></code>. However,
we will use the rpm macro variable of <code>%{name}</code> in it’s place for consistency.</p>
</div>
<div class="paragraph">
<p>The <code>Source0</code> field is where the upstream software’s source code should be
able to be downloaded from. This URL should link directly to the specific
version of the source code release that this RPM Package is packaging. Once
again, since this is an example we will use an example value:
<code><a href="https://example.com/cello/releases/cello-1.0.tar.gz" class="bare">https://example.com/cello/releases/cello-1.0.tar.gz</a></code></p>
</div>
<div class="paragraph">
<p>We should note that this example URL has hard coded values in it that are
possible to change in the future and are potentially even likely to change such
as the release version <code>1.0</code>. We can simplify this by only needing to update
one field in the SPEC file and allowing it to be reused. we will use the value
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code> instead of
the hard coded examples string previously listed.</p>
</div>
<div class="paragraph">
<p>The next item is to provide a listing for the <code>.patch</code> file we created earlier
such that we can apply it to the code later in the <code>%setup</code> section. We will
need a listing of <code>Patch0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cello-output-first-patch.patch</code>.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

Patch0:         cello-output-first-patch.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up we have <code>BuildRequires</code> and <code>Requires</code>, each of which define
something that is required by the package. However, <code>BuildRequires</code> is to tell
<code>rpmbuild</code> what is needed by your package at <strong>build</strong> time and <code>Requires</code>
is what is needed by your package at <strong>run</strong> time.</p>
</div>
<div class="paragraph">
<p>In this example we will need the <code>gcc</code> and <code>make</code> packages in order to
perform the compilation build process. Runtime requirements are fortunately
handled for us by rpmbuild because this program does not require anything
outside of the core <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> standard libraries and we therefore will not need to
define anything by hand as a <code>Requires</code> and can omit that directive.</p>
</div>
<div class="paragraph">
<p>After your edits, the top portion of your spec file should look like the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

BuildRequires:  gcc
BuildRequires:  make</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following directives can be thought of as “section headings” because they
are directives that can define multi-line, multi-instruction, or scripted tasks
to occur. We will walk through them one by one just as we did with the previous
items.</p>
</div>
<div class="paragraph">
<p>The <code>%description</code> should be a longer, more full length description of the
software being packaged than what is found in the <code>Summary</code> directive. For the
sake of our example, this isn’t really going to contain much content but this
section can be a full paragraph or more than one paragraph if desired.</p>
</div>
<div class="paragraph">
<p>The <code>%prep</code> section is where we <em>prepare</em> our build environment or workspace
for building. Most often what happens here is the expansion of compressed
archives of the source code, application of patches, and potentially parsing of
information provided in the source code that is necessary in a later portion of
the SPEC. In this section we will simply use the provided macro <code>%setup -q</code>.</p>
</div>
<div class="paragraph">
<p>The <code>%build</code> section is where we tell the system how to actually build the
software we are packaging. Since wrote a simple <code>Makefile</code> for our <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
implementation, we can simply use the <a href="http://www.gnu.org/software/make/">GNU make</a> command provided by
<code>rpmdev-newspec</code>. However, we need to remove the call to <code>%configure</code>
because we did not provide a <a href="https://en.wikipedia.org/wiki/Configure_script">configure script</a>. The <code>%build</code> section of our
SPEC file should look as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%build
make %{?_smp_mflags}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%install</code> section is where we instruct <code>rpmbuild</code> how to install our
previously built software into the <code>BUILDROOT</code> which is effectively a
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> base directory with nothing in it and we will have to construct any
paths or directory hierarchies that we will need in order to install our
software here in their specific locations. However, our RPM Macros help us
accomplish this task without having to hardcode paths.</p>
</div>
<div class="paragraph">
<p>Once again, since we have a simple <code>Makefile</code> the installation step can be
accomplished easily by leaving in place the <code>%make_install</code> macro that was
again provided for us by the <code>rpmdev-newspec</code> command.</p>
</div>
<div class="paragraph">
<p>The <code>%install</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install
%make_install</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>%files</code> section is where we provide the list of files that this RPM
provides and where it’s intended for them to live on the system that the RPM is
installed upon. Note here that this isn’t relative to the <code>%{buildroot}</code> but
the full path for the files as they are expected to exist on the end system
after installation. Therefore, the listing for the <code>cello</code> file we are
installing will be <code>%{_bindir}/cello</code>.</p>
</div>
<div class="paragraph">
<p>Also within this section, you will sometimes need a built-in macro to provide
context on a file. This can be useful for Systems Administrators and end users
who might want to query the system with <code>rpm</code> about the resulting package.
The built-in macro we will use here is <code>%license</code> which will tell <code>rpmbuild</code>
that this is a software license file in the package file manifest metadata.</p>
</div>
<div class="paragraph">
<p>The <code>%files</code> section should look like the following after your edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%{_bindir}/%{name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last section, <code>%changelog</code> is a list of date-stamped entries that
correlate to a specific Version-Release of the package. This is not meant to be
a log of what changed in the software from release to release, but specifically
to packaging changes. For example, if software in a package needed patching or
there was a change needed in the build procedure listed in the <code>%build</code>
section that information would go here. Each change entry can contain multiple
items and each item should start on a new line and begin with a <code>-</code> character.
Below is our example entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First cello package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the format above, the date-stamp will begin with a <code>*</code> character,
followed by the calendar day of the week, the month, the day of the month, the
year, then the contact information for the RPM Packager. From there we have
a <code>-</code> character before the Version-Release, which is an often used convention
but not a requirement. Then finally the Version-Release.</p>
</div>
<div class="paragraph">
<p>That’s it! We’ve written an entire SPEC file for <strong>cello</strong>! In the next section
we will cover how to build the RPM!</p>
</div>
<div class="paragraph">
<p>The full SPEC file should now look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

Patch0:         cello-output-first-patch.patch

BuildRequires:  gcc
BuildRequires:  make

%description
The long-tail description for our Hello World Example implemented in
C

%prep
%setup -q

%patch0

%build
make %{?_smp_mflags}

%install
%make_install

%files
%license LICENSE
%{_bindir}/%{name}

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 1.0-1
- First cello package</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-rpms">Building RPMS</h3>
<div class="paragraph">
<p>When building RPMs there are is one main command, which is <code>rpmbuild</code> and we
will use that through out the guide. It has been eluded to in various sections
in the guide but now we’re actually going to dig in and get our hands dirty.</p>
</div>
<div class="paragraph">
<p>We will cover a couple different combinations of arguments we can pass to
<code>rpmbuild</code> based on scenario and desired outcome but we will focus primarily
on the two main targets of building an RPM and that is creating Source and
Binary RPMs.</p>
</div>
<div class="paragraph">
<p>One of the things you may notice about <code>rpmbuild</code> is that it expects the
directory structure created in a certain way and for various items such as
source code to exist within the context of that directory structure. Luckily,
this is the same directory structure that was setup by the <code>rpmdev-setuptree</code>
utility that we used previously to setup our RPM workspace and we have been
placing files in the correct place through out the duration of the guide.</p>
</div>
<div class="sect3">
<h4 id="source-rpms">Source RPMs</h4>
<div class="paragraph">
<p>Before we actually build a Source RPM, let’s quickly address why we would want
to do this. First, we might want to preserve the exact source of a
Name-Version-Release of RPM that we deployed to our environment that included
the exact SPEC file, the source code, and all relevant patches. This can be
useful when looking back in history and/or debugging if something has gone
wrong. Another reason is if we want to build a Binary RPM on a different
hardware platform or <a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a>.</p>
</div>
<div class="paragraph">
<p>In order to create a Source RPM we need to pass the “build source” or <code>-bs</code>
option to <code>rpmbuild</code> and we will provide a SPEC file as the argument. We
will do so for each of our examples we’ve created above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~/rpmbuild/SPECS/

$ rpmbuild -bs bello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm

$ rpmbuild -bs pello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm

$ rpmbuild -bs cello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s it! That’s all there is to building a Source RPM or SRPM. Do note the
directory that it was placed in though, this is also a part of the directory
hierarchy that we covered previously.</p>
</div>
<div class="paragraph">
<p>Now it’s time to move on to Binary RPMs!</p>
</div>
</div>
<div class="sect3">
<h4 id="binary-rpms">Binary RPMS</h4>
<div class="paragraph">
<p>When building Binary RPMs there are a few methods by which we could do this, we
could “rebuild” a SRPM by passing the <code>--rebuild</code> option to <code>rpmbuild</code>. We
could tell <code>rpmbuild</code> to “build binary” or <code>-bb</code> and pass a SPEC file as the
argument similar to how we did for the Source RPMs.</p>
</div>
<div class="sect4">
<h5 id="rebuild">Rebuild</h5>
<div class="paragraph">
<p>Let’s first rebuild each of our examples. Below you will see the example output
generated from rebuilding each example SRPM. You will notice the output will
vary differently based on the specific example you view and that the amount of
detail provided is quite verbose. This maybe seem daunting at first but as you
become a seasoned RPM Packager you will learn to appreciate and even welcome
this level of detail as it can prove to be very valuable when diagnosing issues.</p>
</div>
<div class="paragraph">
<p>One important distinction to make about when <code>rpmbuild</code> is invoked with the
<code>--rebuild</code> argument is that it actually installs the contents of the SRPM
into your <code>~/rpmbuild</code> directory which will install the SPEC file and source
code, then the build is performed and the SPEC file and Source code are removed.
This might seem odd at first, but know that this is expected behavior and you
can perform a <code>--recompile</code> which will not do the “clean up” operation at the
end. We selected to use <code>--rebuild</code> in this guide to demonstrate how this
happens and how you can “recover” from it to get the SPEC files and SOURCES
back which is covered in the following section.</p>
</div>
<div class="paragraph">
<p>The commands required for each are as follows, with detailed output provided for
each below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm

$ rpmbuild --rebuild ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm

$ rpmbuild --rebuild ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you’ve built RPMs!</p>
</div>
<div class="paragraph">
<p>You will now find the resulting Binary RPMs in <code>~/rpmbuild/RPMS/</code> depending on
your <a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a> and/or if the package was <code>noarch</code>.</p>
</div>
<div class="paragraph">
<p>At the end of each of these commands you will find that there are no longer SPEC
files or contents in SOURCES for the specific SRPMs that you rebuilt because of
how <code>--rebuild</code> cleans up after itself. We can resolve this by executing the
following <a href="http://rpm.org/">rpm</a> commands which will perform an install of the SRPMs. You will
want to do this after running a <code>--rebuild</code> if you want to continue to
interact with the SPEC and SOURCES which we will want to do for the duration of
this guide.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -Uvh ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
Updating / installing...
   1:bello-0.1-1.el7                  ################################# [100%]

$ rpm -Uvh ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
Updating / installing...
   1:pello-0.1.1-1.el7                ################################# [100%]

$ rpm -Uvh ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
Updating / installing...
   1:cello-1.0-1.el7                  ################################# [100%]</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="bello-rebuild">bello</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
Installing /home/admiller/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.GHTHCO
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf bello-0.1
+ /usr/bin/gzip -dc /home/admiller/rpmbuild/SOURCES/bello-0.1.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd bello-0.1
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.xmnIiZ
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd bello-0.1
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.WXBLZ9
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ '[' /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64 '!=' / ']'
+ rm -rf /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
++ dirname /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT
+ mkdir /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
+ cd bello-0.1
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64//usr/bin
+ install -m 0755 bello /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64//usr/bin/bello
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /home/admiller/rpmbuild/BUILD/bello-0.1
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 0 CRC32s did match.
+ '[' noarch = noarch ']'
+ case &quot;${QA_CHECK_RPATHS:-}&quot; in
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: bello-0.1-1.el7.noarch
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.7wU0nl
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd bello-0.1
+ LICENSEDIR=/home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64/usr/share/licenses/bello-0.1
+ export LICENSEDIR
+ /usr/bin/mkdir -p /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64/usr/share/licenses/bello-0.1
+ cp -pr LICENSE /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64/usr/share/licenses/bello-0.1
+ exit 0
Provides: bello = 0.1-1.el7
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: /bin/bash
Checking for unpackaged file(s): /usr/lib/rpm/check-files /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
Wrote: /home/admiller/rpmbuild/RPMS/noarch/bello-0.1-1.el7.noarch.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.R9eRPW
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd bello-0.1
+ /usr/bin/rm -rf /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
+ exit 0
Executing(--clean): /bin/sh -e /var/tmp/rpm-tmp.S59sAf
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf bello-0.1
+ exit 0</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="pello-rebuild">pello</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
Installing /home/admiller/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.kRf2qV
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf pello-0.1.1
+ /usr/bin/gzip -dc /home/admiller/rpmbuild/SOURCES/pello-0.1.1.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd pello-0.1.1
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.h0DkgE
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd pello-0.1.1
+ python -m compileall pello.py
Compiling pello.py ...
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.k0YN9m
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ '[' /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64 '!=' / ']'
+ rm -rf /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
++ dirname /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT
+ mkdir /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
+ cd pello-0.1.1
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64//usr/bin
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/lib/pello
+ cat
+ chmod 0755 /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64//usr/bin/pello
+ install -m 0644 pello.py pello.pyc /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/lib/pello/
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /home/admiller/rpmbuild/BUILD/pello-0.1.1
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 0 CRC32s did match.
find: 'debug': No such file or directory
+ '[' noarch = noarch ']'
+ case &quot;${QA_CHECK_RPATHS:-}&quot; in
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: pello-0.1.1-1.el7.noarch
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.22ODva
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd pello-0.1.1
+ LICENSEDIR=/home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/share/licenses/pello-0.1.1
+ export LICENSEDIR
+ /usr/bin/mkdir -p /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/share/licenses/pello-0.1.1
+ cp -pr LICENSE /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/share/licenses/pello-0.1.1
+ exit 0
Provides: pello = 0.1.1-1.el7
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PartialHardlinkSets) &lt;= 4.0.4-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: /bin/bash
Checking for unpackaged file(s): /usr/lib/rpm/check-files /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
Wrote: /home/admiller/rpmbuild/RPMS/noarch/pello-0.1.1-1.el7.noarch.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.kZTRbM
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd pello-0.1.1
+ /usr/bin/rm -rf /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
+ exit 0
Executing(--clean): /bin/sh -e /var/tmp/rpm-tmp.WChx3z
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf pello-0.1.1
+ exit 0</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="cello-rebuild">cello</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
Installing /home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.ySAWzh
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf cello-1.0
+ /usr/bin/gzip -dc /home/admiller/rpmbuild/SOURCES/cello-1.0.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd cello-1.0
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ echo 'Patch #0 (cello-output-first-patch.patch):'
Patch #0 (cello-output-first-patch.patch):
+ /usr/bin/cat /home/admiller/rpmbuild/SOURCES/cello-output-first-patch.patch
+ /usr/bin/patch -p0 --fuzz=0
patching file cello.c
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.LZZAxn
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd cello-1.0
+ make -j3
gcc -o cello cello.c
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.SSAzEt
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ '[' /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64 '!=' / ']'
+ rm -rf /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
++ dirname /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT
+ mkdir /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
+ cd cello-1.0
+ /usr/bin/make install DESTDIR=/home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
mkdir -p /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/bin
install -m 0755 cello /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/bin/cello
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /home/admiller/rpmbuild/BUILD/cello-1.0
extracting debug info from /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/bin/cello
dwz: Too few files for multifile optimization
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 1 CRC32s did match.
+ '[' '%{buildarch}' = noarch ']'
+ QA_CHECK_RPATHS=1
+ case &quot;${QA_CHECK_RPATHS:-}&quot; in
+ /usr/lib/rpm/check-rpaths
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: cello-1.0-1.el7.x86_64
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.L0PliA
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd cello-1.0
+ LICENSEDIR=/home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/share/licenses/cello-1.0
+ export LICENSEDIR
+ /usr/bin/mkdir -p /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/share/licenses/cello-1.0
+ cp -pr LICENSE /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/share/licenses/cello-1.0
+ exit 0
Provides: cello = 1.0-1.el7 cello(x86-64) = 1.0-1.el7
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: libc.so.6()(64bit) libc.so.6(GLIBC_2.2.5)(64bit) rtld(GNU_HASH)
Processing files: cello-debuginfo-1.0-1.el7.x86_64
Provides: cello-debuginfo = 1.0-1.el7 cello-debuginfo(x86-64) = 1.0-1.el7
Requires(rpmlib): rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1 rpmlib(CompressedFileNames) &lt;= 3.0.4-1
Checking for unpackaged file(s): /usr/lib/rpm/check-files /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
Wrote: /home/admiller/rpmbuild/RPMS/x86_64/cello-1.0-1.el7.x86_64.rpm
Wrote: /home/admiller/rpmbuild/RPMS/x86_64/cello-debuginfo-1.0-1.el7.x86_64.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.oexkNU
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd cello-1.0
+ /usr/bin/rm -rf /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
+ exit 0
Executing(--clean): /bin/sh -e /var/tmp/rpm-tmp.ENKUE1
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf cello-1.0
+ exit 0</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="build-binary">Build Binary</h5>
<div class="paragraph">
<p>Next up, let’s “build binary” for each of our examples. Just as in the previous
example, you will again see the example output generated from building each
example. Similarly you will notice the output will vary differently based on the
specific example you view and that the amount of detail provided is quite
verbose.</p>
</div>
<div class="paragraph">
<p>The commands required for each are as follows, with detailed output provided for
each below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -bb ~/rpmbuild/SPECS/bello.spec

$ rpmbuild -bb ~/rpmbuild/SPECS/pello.spec

$ rpmbuild -bb ~/rpmbuild/SPECS/cello.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you’ve built RPMs!</p>
</div>
<div class="paragraph">
<p>You will now find the resulting Binary RPMs in <code>~/rpmbuild/RPMS/</code> depending on
your <a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a> and/or if the package was <code>noarch</code>.</p>
</div>
<div class="sect5">
<h6 id="bello-build-binary">bello</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -bb ~/rpmbuild/SPECS/bello.spec
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.aaCBH0
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf bello-0.1
+ /usr/bin/gzip -dc /home/admiller/rpmbuild/SOURCES/bello-0.1.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd bello-0.1
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.mOSeGQ
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd bello-0.1
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.LW9TFG
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ '[' /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64 '!=' / ']'
+ rm -rf /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
++ dirname /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT
+ mkdir /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
+ cd bello-0.1
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64//usr/bin
+ install -m 0755 bello /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64//usr/bin/bello
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /home/admiller/rpmbuild/BUILD/bello-0.1
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 0 CRC32s did match.
+ '[' noarch = noarch ']'
+ case &quot;${QA_CHECK_RPATHS:-}&quot; in
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: bello-0.1-1.el7.noarch
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.wAswQw
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd bello-0.1
+ LICENSEDIR=/home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64/usr/share/licenses/bello-0.1
+ export LICENSEDIR
+ /usr/bin/mkdir -p /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64/usr/share/licenses/bello-0.1
+ cp -pr LICENSE /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64/usr/share/licenses/bello-0.1
+ exit 0
Provides: bello = 0.1-1.el7
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: /bin/bash
Checking for unpackaged file(s): /usr/lib/rpm/check-files /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
Wrote: /home/admiller/rpmbuild/RPMS/noarch/bello-0.1-1.el7.noarch.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.74OMCd
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd bello-0.1
+ /usr/bin/rm -rf /home/admiller/rpmbuild/BUILDROOT/bello-0.1-1.el7.x86_64
+ exit 0</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="pello-build-binary">pello</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -bb pello.spec
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.dvOeYv
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf pello-0.1.1
+ /usr/bin/gzip -dc /home/admiller/rpmbuild/SOURCES/pello-0.1.1.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd pello-0.1.1
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.QD4XFU
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd pello-0.1.1
+ python -m compileall pello.py
Compiling pello.py ...
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.qEbZqj
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ '[' /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64 '!=' / ']'
+ rm -rf /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
++ dirname /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT
+ mkdir /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
+ cd pello-0.1.1
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64//usr/bin
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/lib/pello
+ cat
+ chmod 0755 /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64//usr/bin/pello
+ install -m 0644 pello.py pello.pyc /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/lib/pello/
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /home/admiller/rpmbuild/BUILD/pello-0.1.1
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 0 CRC32s did match.
find: 'debug': No such file or directory
+ '[' noarch = noarch ']'
+ case &quot;${QA_CHECK_RPATHS:-}&quot; in
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: pello-0.1.1-1.el7.noarch
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.Vc2ApI
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd pello-0.1.1
+ LICENSEDIR=/home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/share/licenses/pello-0.1.1
+ export LICENSEDIR
+ /usr/bin/mkdir -p /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/share/licenses/pello-0.1.1
+ cp -pr LICENSE /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64/usr/share/licenses/pello-0.1.1
+ exit 0
Provides: pello = 0.1.1-1.el7
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PartialHardlinkSets) &lt;= 4.0.4-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: /bin/bash
Checking for unpackaged file(s): /usr/lib/rpm/check-files /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
Wrote: /home/admiller/rpmbuild/RPMS/noarch/pello-0.1.1-1.el7.noarch.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.4tTJSw
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd pello-0.1.1
+ /usr/bin/rm -rf /home/admiller/rpmbuild/BUILDROOT/pello-0.1.1-1.el7.x86_64
+ exit 0</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="cello-build-binary">cello</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -bb ~/rpmbuild/SPECS/cello.spec
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.FveYdS
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd /home/admiller/rpmbuild/BUILD
+ rm -rf cello-1.0
+ /usr/bin/gzip -dc /home/admiller/rpmbuild/SOURCES/cello-1.0.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd cello-1.0
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ echo 'Patch #0 (cello-output-first-patch.patch):'
Patch #0 (cello-output-first-patch.patch):
+ /usr/bin/cat /home/admiller/rpmbuild/SOURCES/cello-output-first-patch.patch
+ /usr/bin/patch -p0 --fuzz=0
patching file cello.c
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.ros7nt
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd cello-1.0
+ make -j3
gcc -o cello cello.c
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.qSW6D4
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ '[' /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64 '!=' / ']'
+ rm -rf /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
++ dirname /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
+ mkdir -p /home/admiller/rpmbuild/BUILDROOT
+ mkdir /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
+ cd cello-1.0
+ /usr/bin/make install DESTDIR=/home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
mkdir -p /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/bin
install -m 0755 cello /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/bin/cello
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /home/admiller/rpmbuild/BUILD/cello-1.0
extracting debug info from /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/bin/cello
dwz: Too few files for multifile optimization
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 1 CRC32s did match.
+ '[' '%{buildarch}' = noarch ']'
+ QA_CHECK_RPATHS=1
+ case &quot;${QA_CHECK_RPATHS:-}&quot; in
+ /usr/lib/rpm/check-rpaths
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: cello-1.0-1.el7.x86_64
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.IqHIpG
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd cello-1.0
+ LICENSEDIR=/home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/share/licenses/cello-1.0
+ export LICENSEDIR
+ /usr/bin/mkdir -p /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/share/licenses/cello-1.0
+ cp -pr LICENSE /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64/usr/share/licenses/cello-1.0
+ exit 0
Provides: cello = 1.0-1.el7 cello(x86-64) = 1.0-1.el7
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: libc.so.6()(64bit) libc.so.6(GLIBC_2.2.5)(64bit) rtld(GNU_HASH)
Processing files: cello-debuginfo-1.0-1.el7.x86_64
Provides: cello-debuginfo = 1.0-1.el7 cello-debuginfo(x86-64) = 1.0-1.el7
Requires(rpmlib): rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1 rpmlib(CompressedFileNames) &lt;= 3.0.4-1
Checking for unpackaged file(s): /usr/lib/rpm/check-files /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
Wrote: /home/admiller/rpmbuild/RPMS/x86_64/cello-1.0-1.el7.x86_64.rpm
Wrote: /home/admiller/rpmbuild/RPMS/x86_64/cello-debuginfo-1.0-1.el7.x86_64.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.ZRORXv
+ umask 022
+ cd /home/admiller/rpmbuild/BUILD
+ cd cello-1.0
+ /usr/bin/rm -rf /home/admiller/rpmbuild/BUILDROOT/cello-1.0-1.el7.x86_64
+ exit 0</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="checking-rpms-for-sanity">Checking RPMs For Sanity</h3>
<div class="paragraph">
<p>Once we have created a package, we may desire to perform some sort of checks for
quality on the package itself and not necessarily just the software we’re
delivering with the RPM.</p>
</div>
<div class="paragraph">
<p>For this the main tool of choice for RPM Packagers is <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> which performs
many sanity and error checks that help assist with packaging in more
maintainable and less error prone fashion. Something to keep in mind is that
this is going to report things based on very strict guidelines and by way of
static analysis. There is going to be lack of perspective by the <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> tool
and what your primary objective is and thus it is sometimes alright to allow
Errors or Warnings reported by <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> to persist in your packages, but the
key is to understand <strong>why</strong> we would allow these to persist. In the follow
sections we will explore a couple examples of just that.</p>
</div>
<div class="paragraph">
<p>Another really useful feature of <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> is that we can use it to check
against Binary RPMs, Source RPMs, and SPEC files so that it can be used during
all stages of packaging and not just after the fact. We will show examples of
each below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For each example below we run <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> without any options, if you would
like detailed explanations of what each Error or Warning means, then you can
pass the <code>-i</code> option and run each command as <code>rpmlint -i</code> instead of
just <code>rpmlint</code>. The shorter output is selected for brevity of the
document.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="bello-checking-rpms-for-sanity">bello</h4>
<div class="paragraph">
<p>Let’s get started by looking at some output and dive into each set of output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint bello.spec
bello.spec: W: invalid-url Source0: https://www.example.com/bello/releases/bello-0.1.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 0 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>When checking <em>bello</em>‘s spec file we can see that we only have one warning and
that is the URL listed in the <code>Source0</code> directive can not be reached which is
something that we would expect given that example.com doesn’t actually exist out
in the real world and we’ve not setup a system with a local DNS entry to point
to this URL. Since we know why the Warning was emitted and that it was expect,
this can be safely ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
bello.src: W: invalid-url URL: https://www.example.com/bello HTTP Error 404: Not Found
bello.src: W: invalid-url Source0: https://www.example.com/bello/releases/bello-0.1.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 0 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>When checking <em>bello</em>‘s SRPM we can see very similar output from the check
against the spec file but we also see that the check against the SRPM looks for
the <code>URL</code> directive as well as the <code>Source0</code> directive, neither can be
reached but as we know is expected and these can also be safely ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/noarch/bello-0.1-1.el7.noarch.rpm
bello.noarch: W: invalid-url URL: https://www.example.com/bello HTTP Error 404: Not Found
bello.noarch: W: no-documentation
bello.noarch: W: no-manual-page-for-binary bello
1 packages and 0 specfiles checked; 0 errors, 3 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now things will change a bit when looking at Binary RPMs as the <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a>
utility is going to check for other things that should be commonly found in
Binary RPMs such as documentation and/or <a href="https://en.wikipedia.org/wiki/Man_page">man pages</a> as well as things like
consistent use of the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>. As we can see, this is
exactly what is being reported and we know that there are no <a href="https://en.wikipedia.org/wiki/Man_page">man pages</a> or
other documentation because we didn’t provide any. Also, once again our old
friend the <code>HTTP Error 404: Not Found</code> is present but we’re well aware as to
why.</p>
</div>
<div class="paragraph">
<p>Other than our few items that we are carrying over because this is a simple
example, our RPM is passing the <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> checks and all is well!</p>
</div>
</div>
<div class="sect3">
<h4 id="pello-checking-rpms-for-sanity">pello</h4>
<div class="paragraph">
<p>Next up, let’s get look at some more output and dive into it one by one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint pello.spec
pello.spec:30: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}
pello.spec:34: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.pyc
pello.spec:39: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}/
pello.spec:43: E: hardcoded-library-path in /usr/lib/%{name}/
pello.spec:45: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.py*
pello.spec: W: invalid-url Source0: https://www.example.com/pello/releases/pello-0.1.1.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 5 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, I know you might be thinking “That’s a lot of errors, this example must be
really wrong” and you would be correct but it is wrong for good reason. The goal
here is two fold, first to make a byte-compiled example that was not too
complicated and allowed to demonstrate some scripting in a SPEC file and second
to show some examples of what we can expect <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> to report other than just
a simple URL missing.</p>
</div>
<div class="paragraph">
<p>Looking at the output from the check on <em>pello</em>‘s spec file we can see that we
have a new Error entitled <code>hardcoded-library-path</code> and it was mentioned during
the previous section that this was known to be incorrect but we were doing it
anyways. The reality is that this is a half truth. Almost always, you should be
using the <code>%{_libdir}</code> rpm macro or some other more sophisticated macro (more
on this in the <a href="#appendix">Appendix</a>. The reason we do not use
<code>%{_libdir}</code> in this instance is because that macro will expand to be either
<code>/usr/lib/</code> or <code>/usr/lib64/</code> depending on a 32-bit or 64-bit
<a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a>. Since we are packaging <code>noarch</code> that would have become
problematic for one arch or the other in the event of a compile on one, run on
the other. We also don’t dive into more clever rpm macros as they are out of
scope when trying to learn RPM Packaging at and introductory level, which is
already a feat of it’s own. For the sake of this example, we can ignore this
Error but in a real packaging scenario you should either have a reasonable
justification or find the appropriate rpm macro to use.</p>
</div>
<div class="paragraph">
<p>Once again, the URL listed in the <code>Source0</code> directive can not be reached which
is something that we expect for the same reasons given in the previous example.
Since we know why the Warning was emitted and that it was expect, this can be
safely ignored also.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
pello.src: W: invalid-url URL: https://www.example.com/pello HTTP Error 404: Not Found
pello.src:30: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}
pello.src:34: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.pyc
pello.src:39: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}/
pello.src:43: E: hardcoded-library-path in /usr/lib/%{name}/
pello.src:45: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.py*
pello.src: W: invalid-url Source0: https://www.example.com/pello/releases/pello-0.1.1.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 5 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>When checking <em>pello</em>‘s SRPM we can see very similar output from the check
against the spec file but we also see that the check against the SRPM looks for
the <code>URL</code> directive as well as the <code>Source0</code> directive, neither can be
reached but as we know is expected and these can also be safely ignored.</p>
</div>
<div class="paragraph">
<p>Once again, the explanation for the <code>hardcoded-library-path</code> is the same as we
covered previously in the <code>rpmlint</code> output for the SPEC file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/noarch/pello-0.1.1-1.el7.noarch.rpm
pello.noarch: W: invalid-url URL: https://www.example.com/pello HTTP Error 404: Not Found
pello.noarch: W: only-non-binary-in-usr-lib
pello.noarch: W: no-documentation
pello.noarch: E: non-executable-script /usr/lib/pello/pello.py 0644L /usr/bin/env
pello.noarch: W: no-manual-page-for-binary pello
1 packages and 0 specfiles checked; 1 errors, 4 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the previous example, things change a bit when looking at Binary RPMs as
the <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> utility is now checking for other things that should be commonly
found in Binary RPMs such as documentation and/or <a href="https://en.wikipedia.org/wiki/Man_page">man pages</a> as well as things
like consistent use of the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>. As we can see, this
is exactly what is being reported and we know that there are no <a href="https://en.wikipedia.org/wiki/Man_page">man pages</a> or
other documentation because we didn’t provide any. Also, once again our old
friend the <code>HTTP Error 404: Not Found</code> is present but we’re well aware as to
why.</p>
</div>
<div class="paragraph">
<p>The two new ones are <code>non-executable-script</code> and
<code>only-non-binary-in-usr-lib</code>.</p>
</div>
<div class="paragraph">
<p>First is <code>W: only-non-binary-in-usr-lib</code> which means that we’ve provided only
non-binary artifacts in <code>/usr/lib/</code> which is normally reserved for shared
object files which are binary data files and <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> therefore expects at
least some of our files in <code>/usr/lib/</code> to be binary. This again rounds back to
compliance with the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a> as well as files ending up
in incorrect or inconsistent locations because we are not using the appropriate
rpm macros. This is of course by design <em>only</em> for the course of this example.</p>
</div>
<div class="paragraph">
<p>Next up is <code>E: non-executable-script /usr/lib/pello/pello.py 0644L /usr/bin/env</code>
which is telling us that <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> has found a file with a
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a> directive which would normally be an executable and have permissions
more likely to be <code>0755</code> instead of <code>0644</code> (meaning it can not be executed),
but since we’re simply leaving it as an install artifact reference library
because we used this as an example for doing byte-compilation at build time this
can also be safely ignored.</p>
</div>
<div class="paragraph">
<p>Other than our items that we are carrying over for the purposes of the example,
our RPM is passing the <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> checks and all is well!</p>
</div>
</div>
<div class="sect3">
<h4 id="cello-checking-rpms-for-sanity">cello</h4>
<div class="paragraph">
<p>Next up, let’s get look at some more output and dive into each.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SPECS/cello.spec
/home/admiller/rpmbuild/SPECS/cello.spec: W: invalid-url Source0: https://www.example.com/cello/releases/cello-1.0.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 0 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>When checking <em>cello</em>‘s spec file we can see that things appear much more as
they did in our first example and we only have one warning. This is again that
the URL listed in the <code>Source0</code> directive can not be reached which is
something expected. Since we know why the Warning was emitted and that it was
expect, this can be safely ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
cello.src: W: invalid-url URL: https://www.example.com/cello HTTP Error 404: Not Found
cello.src: W: invalid-url Source0: https://www.example.com/cello/releases/cello-1.0.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 0 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>When checking <em>cello</em>‘s SRPM we can see very similar output from the check
against the spec file but we also see that the check against the SRPM looks for
the <code>URL</code> directive as well as the <code>Source0</code> directive, neither can be
reached but as we know is expected and these can also be safely ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/x86_64/cello-1.0-1.el7.x86_64.rpm
cello.x86_64: W: invalid-url URL: https://www.example.com/cello HTTP Error 404: Not Found
cello.x86_64: W: no-documentation
cello.x86_64: W: no-manual-page-for-binary cello
1 packages and 0 specfiles checked; 0 errors, 3 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before, the output has changed when looking at Binary RPMs as the <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a>
utility is going to check for other things that should be commonly found in
Binary RPMs such as documentation and/or <a href="https://en.wikipedia.org/wiki/Man_page">man pages</a> as well as things like
consistent use of the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>. As we can see, this is
exactly what is being reported just as in the previous examples and we know that
there are no <a href="https://en.wikipedia.org/wiki/Man_page">man pages</a> or other documentation because we didn’t provide any.
Also, once again the <code>HTTP Error 404: Not Found</code> is present but we’re well
aware as to why.</p>
</div>
<div class="paragraph">
<p>Other than our few items that we are carrying over because this is a simple
example, our RPM is passing the <a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a> checks and all is well!</p>
</div>
<div class="paragraph">
<p>That’s it!</p>
</div>
<div class="paragraph">
<p>Our RPMs are sanitized (or we know and understand why they aren’t) and it is now
time to either go forth and Package RPMs or travel on into the
<a href="#appendix">Appendix</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="general-topics-and-background">General Topics and Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section will we walk through various topics about building software that
are helpful background or otherwise general topics that are important for a good
RPM Packager to be familiar with.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What is <a href="https://en.wikipedia.org/wiki/Source_code">Source Code</a>?</p>
</li>
<li>
<p>How Programs Are Made</p>
</li>
<li>
<p>Building from source into an output artifact (what type of artifact will
depend on the scenario and we will define what this means more specifically
with examples).</p>
</li>
<li>
<p>Patching Software</p>
</li>
<li>
<p>Placing those output artifacts somewhere on the system that is useful within
the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="what-is-source-code">What is Source Code?</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are familiar with what the following terms mean then feel free to
skip this section: source code, programming, programming languages.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the world of computer software, <strong>source code</strong> is the term used to the
representation of instructions to the computer about how to perform a task in
a way that is human readable, normally as simple text. This human readable
format is expressed using a <a href="https://en.wikipedia.org/wiki/Programming_language">programming language</a> which basically boils down
to a set of rules about that programmers learn so that the text they write is
meaningful to the computer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There are many thousands of programming languages in the world. In this
document we will provide examples of only a couple, some finer points of
various programming languages are going to vary but hopefully this guide
will prove to be a good conceptual overview.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the following three examples are all a very simple program that
will display the text <code>Hello World</code> to the command line. The reason for three
versions of the example will become apparent in the next section but this is
three implementations of the same program written in different programming
languages. The program is a very common starting place for newcomers to the
programming world so it may appear familiar to some readers, but if it doesn’t
do not worry.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the first two examples below, the <code>#!</code> line is known as a <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
and is not technically part of the programming language source code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This version of the example is written in the <a href="https://www.gnu.org/software/bash/">bash</a> shell built in scripting
language.</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf &quot;Hello World\n&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the example is written in a programming language named
<a href="https://www.python.org/">Python</a>.</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#!/usr/bin/env python</span>

print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the example is written in a programming language named <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>.</p>
</div>
<div class="paragraph">
<p><code>cello.c</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>

<span class="predefined-type">int</span> main(<span class="directive">void</span>) {
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="integer">0</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The finer points of how to write software isn’t necessarily important at this
time but if you felt so inclined to learn to program that would certainly be
beneficial in your adventures as a software packager.</p>
</div>
<div class="paragraph">
<p>As mentioned before, the output of both examples to the command line will be
simply, <code>Hello World</code> when the source code is built and run. The topic of how
that happens is up next!</p>
</div>
</div>
<div class="sect2">
<h3 id="how-programs-are-made">How Programs Are Made</h3>
<div class="paragraph">
<p>Before we dive too far into how to actually build code it is best to first
understand a few items about software source code and how it becomes
instructions to the computer. Effectively, how programs are actually made. There
many ways in which a program can be executed but it boils down to effectively
two common methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Natively Compiled</p>
</li>
<li>
<p>Interpreted (Byte Compiled and Raw Interpreted)</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="natively-compiled-code">Natively Compiled Code</h4>
<div class="paragraph">
<p>Software written in programming languages that compile to machines code or
directly to a binary executable (i.e. - something that the computer natively
understands without an help) that can be run stand alone is considered to be
<strong>Natively Compiled</strong>. This is important for building <a href="http://rpm.org/">RPM</a> Packages because
packages built this way are what is known as <a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a> specific, meaning
that if you compile this particular piece of software on a computer that uses a
64-bit (x86_64) AMD or Intel processor, it will not execute on a (x86) 32-bit
AMD or Intel processor. The method by which this happens will be covered in the
next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="interpreted-code">Interpreted Code</h4>
<div class="paragraph">
<p>There are certain programming languages that do not compile down to a
representation of program that the computer natively understands. These programs
are <strong>Interpreted</strong> and require a Language <a href="https://en.wikipedia.org/wiki/Interpreter_%28computing%29">Interpreter</a> or Language Virtual
Machine(VM). The name <em>interpreter</em> comes from it’s similarities with how human
language interpreters convert between two representations of human speech
to allow two people to talk, a programming language interpreter converts from
a format that the computer doesn’t “speak” to one that it does.</p>
</div>
<div class="paragraph">
<p>There are two types of Interpreted Languages, Byte Compiled and Raw Interpreted
and the distinction between these is useful to keep in mind when packaging
software because of the actual <code>%build</code> process is going to be very different
and sometimes in the case of Raw Interpreted Languages there will be no series
of steps required at all for the <code>%build</code>. (What <code>%build</code> means in detail
will be explained later, but the short version is this is how we tell the RPM
Packaging system to actually perform the <em>build</em>). Where as Byte Compiled
programming languages will perform a build task that will “compile” or
“translate” the code from the programming language source that is human readable
to an intermediate representation of the program that is more efficient for the
programming language interpreter to execute.</p>
</div>
<div class="paragraph">
<p>Software written entirely in programming languages such as <a href="https://www.gnu.org/software/bash/">bash</a> shell script
and <a href="https://www.python.org/">Python</a> (as used in our example) are <em>Interpreted</em> and therefore are not
<a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a> specific which means the resulting RPM Package that is created
will be considered <code>noarch</code>. Indicating that it does not have an
<a href="https://en.wikipedia.org/wiki/Microarchitecture">architecture</a> associated with it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-software-from-source">Building Software from Source</h3>
<div class="paragraph">
<p>In this section we will discuss and provide examples of building software from
it’s source code.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are comfortable building software from source code please feel free
to skip this section and move on. However, if you’d like to stick around and
read it then please feel free and it will hopefully serve as a refresher or
possibly contain something interesting that’s new to you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Source code must go through a <strong>build</strong> process and that process will vary based
on specific programming language but most often this is referred to as
<strong>compiling</strong> or <strong>translating</strong> the software. For software written in
interpreted programming languages this step may not be necessary but sometimes it
is desirable to perform what is known as <strong>byte compiling</strong> as it’s build
process. We will cover each scenario below. The resulting built software can
then be <strong>run</strong> or “<strong>executed</strong>” which tells the computer to perform the task
described to it in the source code provided by the programmer who authored the
software.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There are various methods by which software written in different programming
languages can vary heavily. If the software you are interested in packaging
doesn’t follow the exact examples here, this will hopefully be an objective
guideline.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="natively-compiled-code-building-software-from-source">Natively Compiled Code</h4>
<div class="paragraph">
<p>Referencing the example previously used that is written in <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> (listed again
below for the sake of those who may have skipped the previous section), we will
build this source code into something the computer can execute.</p>
</div>
<div class="paragraph">
<p><code>cello.c</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>

<span class="predefined-type">int</span> main(<span class="directive">void</span>) {
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="integer">0</span>;
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="build-process">Build Process</h5>
<div class="paragraph">
<p>In the below example we are going to invoke the <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> compiler from the GNU
Compiler Collection (<a href="https://gcc.gnu.org/">GCC</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcc -o cello cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>From here we can actually execute the resulting output binary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s it! You’ve built natively compiled software from source code!</p>
</div>
<div class="paragraph">
<p>Let’s take this one step further and add a <a href="http://www.gnu.org/software/make/">GNU make</a> Makefile which will help
automate the building of our code. This is an extremely common practice by real
large scale software and is a good thing to become familiar with as a RPM
Packager. Let’s create a file named <code>Makefile</code> in the same directory as our
example <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> source code file named <code>cello.c</code>.</p>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -o cello cello.c

clean:
        rm cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now to build our software we can simply run the command <code>make</code>, below you
will see the command run more than once just for the sake of seeing what is
expected behavior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
make: 'cello' is up to date.

$ make clean
rm cello

$ make
gcc -o cello cello.c

$ make
make: 'cello' is up to date.

+$ ./cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations! You have now both compiled software manually and used a build
tool!</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interpreted-code-building-software-from-source">Interpreted Code</h4>
<div class="paragraph">
<p>For software written in interpreted programming languages, we know that we don’t
need to compile it, but if it’s a byte compiled language such as <a href="https://www.python.org/">Python</a> there
may still be a step required.</p>
</div>
<div class="paragraph">
<p>Referencing the two examples previously (listed again below for the sake of
those who may have skipped the previous section), for <a href="https://www.python.org/">Python</a> we will build
this source code into something the <a href="https://www.python.org/">Python</a> Language Interpreter (known as
<a href="https://en.wikipedia.org/wiki/CPython">CPython</a>) can execute.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In the two examples below, the <code>#!</code> line is known as a <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a> and is
not technically part of the programming language source code.</p>
</div>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a> allows us to use a text file as an executable and the system
program loader will parse the line at the top of the file containing
a <code>#!</code> character sequence looking a path to the binary executable to use
as the programming language interpreter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="byte-compiled-code">Byte Compiled Code</h5>
<div class="paragraph">
<p>As mentioned previously, this version of the example is written in a programming
language named <a href="https://www.python.org/">Python</a> and it’s default language virtual machine is one that
executes <em>byte compiled</em> code. This will “compile” or “translate” the source
code into an intermediate format that is optimized and will be much faster for
the language virtual machine to execute.</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#!/usr/bin/env python</span>

print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The exact procedure to byte compile programs based on language will differ
heavily based on the programming language, it’s language virtual machine, and
the tools or processes that are common within that programming language’s
community. Below is an example using <a href="https://www.python.org/">Python</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The practice of byte compiling <a href="https://www.python.org/">Python</a> is common but the exact procedure
shown here is not. This is meant to be a simple example. For more
information, please reference the <a href="https://docs.python.org/2/library/distribution.html">Software Packaging and Distribution</a>
documentation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ python -m compileall pello.py
$ python pello.pyc
Hello World

$ file pello.pyc
pello.pyc: python 2.7 byte-compiled</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see here that after we byte-compiled the source <code>.py</code> file we now have
a <code>.pyc</code> file which is of <code>python 2.7 byte-compiled</code> filetype. This file can
be run with the python language virtual machine and is more efficient than
passing in just the raw source file, which is a desired attribute of resulting
software we as a RPM Packager will distribute out to systems.</p>
</div>
</div>
<div class="sect4">
<h5 id="raw-interpreted">Raw Interpreted</h5>
<div class="paragraph">
<p>This version of the example is written in the <a href="https://www.gnu.org/software/bash/">bash</a> shell built in scripting
language.</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf &quot;Hello World\n&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>UNIX-style shells have scripting languages, much like <em>bash</em> does, but
programs written in these languages do not have any kind of byte compile
procedure and are interpreted directly as they are written so the only procedure
we have to do is make the file executable and then run it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ chmod +x bello
$ ./bello
Hello World</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="patching-software">Patching Software</h3>
<div class="paragraph">
<p>In software and computing a <strong>patch</strong> is the term given to source code that is
meant to fix other code, this is similar to the way that someone will use
a piece of cloth to patch another piece of cloth that is part of a shirt or
a blanket. Patches in software are formatted as what is called a <em>diff</em> since
it represents what is <em>different</em> between to pieces of source code. A <em>diff</em> is
created using the <code>diff</code> command line utility that is provided by <a href="http://www.gnu.org/software/diffutils/diffutils.html">diffutils</a>
and then it is applied to the original source code using the tool <a href="http://savannah.gnu.org/projects/patch/">patch</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Software developer will often use “Version Control Systems” such as <a href="https://git-scm.com/">git</a>
to manage their code base. Tools like these provide their own methods of
creating diffs or patching software but those are outside the scope of this
document.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let’s walk through an example where we create a patch from the original source
code using <code>diff</code> and then apply it using the <a href="http://savannah.gnu.org/projects/patch/">patch</a> utility. We will
revisit patching software in a later section when it comes to actually building
RPMs and hopefully this exercise will prove it’s usefulness at that time. First
step in patching software is to preserve the original source code because we
want to keep the original source code in pristine condition as we will “patch
it” instead of simply modifying it. A common practice for this is to copy it and
append <code>.orig</code> to the filename. Let’s do that now.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cp cello.c cello.c.orig</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we want to make an edit to <code>cello.c</code> using our favorite text editor.
Update your <code>cello.c</code> to match the output below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>

<span class="predefined-type">int</span> main(<span class="directive">void</span>) {
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World from my very first patch!</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="integer">0</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have our original source code preserved and the updated source code
written, we can generate a patch using the <code>diff</code> utility.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Here we are using a handful of common arguments for the <code>diff</code> utility and
their documentation is out of the scope of this document. Please reference
the manual page on your local machine with: <code>man diff</code> for more
information.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line comment">$ diff -Naur cello.c.orig cello.c</span>
<span class="line head"><span class="head">--- </span><span class="filename">cello.c.orig        2016-05-26 17:21:30.478523360 -0500</span></span>
<span class="line head"><span class="head">+++ </span><span class="filename">cello.c     2016-05-27 14:53:20.668588245 -0500</span></span>
<span class="line change"><span class="change">@@</span> -1,6 +1,6 <span class="change">@@</span></span>
 #include&lt;stdio.h&gt;

 int main(void){
<span class="line delete"><span class="delete">-</span>    printf(&quot;Hello World!\n&quot;);</span>
<span class="line insert"><span class="insert">+</span>    printf(&quot;Hello World<span class="eyecatcher"> from my very first patch</span>!\n&quot;);</span>
     return 1;
 }
<span class="comment">\ No newline at end of file</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the output, you can see lines that start with a <code>-</code> are being removed
from the original source code and replaced by the line that starts with <code>+</code>.
Let’s now save that output to a file this time by redirecting the output to
a file so that we can use it later with the <a href="http://savannah.gnu.org/projects/patch/">patch</a> utility. It is not
a requirement but it’s good practice to use a meaningful filename when creating
patches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ diff -Naur cello.c.orig cello.c &gt; cello-output-first-patch.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we want to restore the <code>cello.c</code> file to it’s original source code such
that it is restored to it’s pristine state and we we can patch it with our new
patch file. The reason this particular process is important is because this is how
it is done when building RPMs, the original source code is left in pristine
condition and we patch it during the process that prepares to source code to be
built.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cp cello.c.orig cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up, let’s go ahead and patch the source code by redirecting the patch file
to the <code>patch</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ patch &lt; cello-output-first-patch.patch
patching file cello.c

$ cat cello.c
#include&lt;stdio.h&gt;

int main(void){
    printf(&quot;Hello World from my very first patch!\n&quot;);
    return 1;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the output of the <code>cat</code> command we can see that the patch has been
successfully applied, let’s build and run it now.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make clean
rm cello

$ make
gcc -o cello cello.c

$ ./cello
Hello World from my very first patch!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations, you have successfully created a patch, patched software, built
the patched software and run it!</p>
</div>
<div class="paragraph">
<p>Next up, installing things!</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-arbitrary-artifacts">Installing Arbitrary Artifacts</h3>
<div class="paragraph">
<p>One of the many really nice things about <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> systems is the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem
Hierarchy Standard</a> (FHS) which defines areas of the filesystem in which things
should be placed. As a RPM Packager this is extremely useful because we will
always know where to place things that come from our source code.</p>
</div>
<div class="paragraph">
<p>This section references the concept of an <strong>Arbitrary Artifact</strong> which in this
context is anything you can imagine that is a file that you want to install
somewhere on the system within the FHS. It could be a simple script,
a pre-existing binary, the binary output of source code that you have created as
a side effect of a build process, or anything else you can think up. We discuss
it in such a vague vocabulary in order to demonstrate that the system nor RPM
care what the <em>Artifact</em> in question is. To both RPM and the system, it is just
a file that needs to exist in a pre-determined place. The permissions and the
type of file it is makes it special to the system but that is for us as a RPM
Packager to decide.</p>
</div>
<div class="paragraph">
<p>For example, once we have built our software we can then place it on the system
somewhere that will end up in the system <a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a> so that they can be found and
executed easily by users, developers, and sysadmins alike. We will explore two
ways to accomplish this as they each are quite popular approaches used by RPM
Packagers.</p>
</div>
<div class="sect3">
<h4 id="install-command">install command</h4>
<div class="paragraph">
<p>When placing arbitrary artifacts onto the system without build automation
tooling such as <a href="http://www.gnu.org/software/make/">GNU make</a> or because it is a simple script and such tooling
would be seen as unnecessary overhead, it is a very common practice to use the
<code>install</code> command (provided to the system by <a href="http://www.gnu.org/software/coreutils/coreutils.html">coreutils</a>) to place the
artifact in a correct location on the filesystem based on where it should exist
in the FHS along with appropriate permissions on the target file or directory.</p>
</div>
<div class="paragraph">
<p>The example below is going to use the <code>bello</code> file that we had previously
created as the arbitrary artifact subject to our installation method. Note that
you will either need <a href="http://www.sudo.ws/">sudo</a> permissions or run this command as root excluding
the <code>sudo</code> portion of the command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sudo install -m 0755 bello /usr/bin/bello</code></pre>
</div>
</div>
<div class="paragraph">
<p>As this point, we can execute <code>bello</code> from our shell no matter what our
current working directory is because it has been installed into our <a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~/

$ bello
Hello World</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="make-install">make install</h4>
<div class="paragraph">
<p>A very popular mechanism by which you will install software from source after
it’s built is by using a command called <code>make install</code> and in order to do that
we need to enhance the <code>Makefile</code> we created previously just a little bit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The creation of <code>Makefile</code> is normally done by the developer who writes
the original source code of the software in question and as a RPM Packager
this is not generally something you will need to do. This is purely an
exercise for background knowledge and we will expand upon this as it relates
to RPM Packaging later.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Open the <code>Makefile</code> file up in your favorite text editor and make the
appropriate edits needed so that it ends up looking exactly as the following.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The use of <a href="https://www.gnu.org/software/make/manual/html_node/DESTDIR.html">$(DESTDIR)</a> is a <a href="http://www.gnu.org/software/make/">GNU make</a> built-in and is commonly used to
install into alternative destination directories.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -o cello cello.c

clean:
        rm cello

install:
        mkdir -p $(DESTDIR)/usr/bin
        install -m 0755 cello $(DESTDIR)/usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are able to use the make file to both build and install the software from
source. Note that for the installation portion, like before when we ran the raw
<code>install</code> command, you will need either <a href="http://www.sudo.ws/">sudo</a> permissions or be the <code>root</code>
user and omit the <code>sudo</code> portion of the command.</p>
</div>
<div class="paragraph">
<p>The following will build and install the simple <code>cello.c</code> program that we had
written previously.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
gcc -o cello cello.c

$ sudo make install
install -m 0755 cello /usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as in the previous example, we can now execute <code>cello</code> from our shell no
matter what our current working directory is because it has been installed into
our <a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~/

$ cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations, you have now installed a build artifact into it’s proper
location on the system!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="prepping-our-example-upstream-source-code">Prepping our example upstream source code</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you’re familiar with how upstream software is distributed and would like
to skip this, please feel free to <a href="https://github.com/redhat-developer/rpm-packaging-guide/tree/master/example-code">download the example source code</a> for
our fake upstream projects skip this section. However if you are curious how
the examples are created please feel free to read along.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that we have our RPM Packaging Workspace setup, we should create simulated
upstream compressed archives of the example programs we have made. We will once
again list them here just in case a previous section was skipped.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
What we are about to do here in this section is not normally something a RPM
Packager has to do, this is normally what happens from an upstream software
project, product, or developer who actually releases the software as source
code. This is simply to setup the RPM Build example space and give some
insight into where everything actually comes from.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will also assume <a href="https://www.gnu.org/licenses/quick-guide-gplv3.html">GPLv3</a> as the <a href="https://en.wikipedia.org/wiki/Software_license">Software License</a> for all of these
simulated upstream software releases. As such, we will need a <code>LICENSE</code> file
included with each source code release. We include this in our simulated
upstream software release because encounters with a <a href="https://en.wikipedia.org/wiki/Software_license">Software License</a> when
packaging RPMs is a very common occurrence for a RPM Packager and we should know
how to properly handle them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The method used below to create the <code>LICENSE</code> file is known as a <a href="https://en.wikipedia.org/wiki/Here_document">here
document</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let us go ahead and make a <code>LICENSE</code> file that can be included in the source
code “release” for each example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat &gt; /tmp/LICENSE &lt;&lt;EOF
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each implementation of the <code>Hello World</code> example script will be created into a
<a href="https://www.gnu.org/software/gzip/">gzip</a> compressed tarball which will be used to simulate what an upstream
project might release as it’s source code to then be consumed and packaged for
distribution.</p>
</div>
<div class="paragraph">
<p>Below is an example procedure for each example implementation.</p>
</div>
<div class="sect3">
<h4 id="bello">bello</h4>
<div class="paragraph">
<p>For the <a href="https://www.gnu.org/software/bash/">bash</a> example implementation we will have a fake project called
<em>bello</em> and since the project named <em>bello</em> produces one thing and that’s
a shell script named <code>bello</code> then it will only contain that in it’s resulting
<code>tar.gz</code>. Let’s pretend that this is version <code>0.1</code> of that software and
we’ll mark the <code>tar.gz</code> file as such.</p>
</div>
<div class="paragraph">
<p>Here is the listing of the file as mentioned before.</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf &quot;Hello World\n&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s make a project <code>tar.gz</code> out of our source code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/bello-0.1

$ mv ~/bello /tmp/bello-0.1/

$ cp /tmp/LICENSE /tmp/bello-0.1/

$ cd /tmp/

$ tar -cvzf bello-0.1.tar.gz bello-0.1
bello-0.1/
bello-0.1/LICENSE
bello-0.1/bello

$ mv /tmp/bello-0.1.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pello">pello</h4>
<div class="paragraph">
<p>For the <a href="https://www.python.org/">Python</a> example implementation we will have a fake project called
<em>pello</em> and since the project named <em>pello</em> produces one thing and that’s
a small program named <code>pello.py</code> then it will only contain that in it’s
resulting <code>tar.gz</code>. Let’s pretend that this is version <code>0.1.1</code> of this
software and we’ll mark the <code>tar.gz</code> file as such.</p>
</div>
<div class="paragraph">
<p>Here is the listing of the file as mentioned before.</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="comment">#!/usr/bin/env python</span>

print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s make a project <code>tar.gz</code> out of our source code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/pello-0.1.1

$ mv ~/pello.py /tmp/pello-0.1.1/

$ cp /tmp/LICENSE /tmp/pello-0.1.1/

$ cd /tmp/

$ tar -cvzf pello-0.1.1.tar.gz pello-0.1.1
pello-0.1.1/
pello-0.1.1/LICENSE
pello-0.1.1/pello.py

$ mv /tmp/pello-0.1.1.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cello">cello</h4>
<div class="paragraph">
<p>For the <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> example implementation we will have a fake project called <em>cello</em>
and since the project named <em>cello</em> produces two things, the source code to our
program named <code>cello.c</code> and a <code>Makefile</code> we will need to make sure and
include both of these in our <code>tar.gz</code>. Let’s pretend that this is version
<code>1.0</code> of the software and we’ll mark the <code>tar.gz</code> file as such.</p>
</div>
<div class="paragraph">
<p>Here is the listing of the files involved as mentioned before.</p>
</div>
<div class="paragraph">
<p>You will notice the <code>patch</code> file is listed here, but it will not go in our
project tarball because it is something that we as the RPM Packager will apply
and not something that comes from the upstream source code. RPM Packages are
built in such a way that the original upstream source code in preserved in it’s
pristine form just as released by it’s creator. All patches required to the
software happen at RPM Build time, not before. We will place that in the
<code>~/rpmbuild/SOURCES/</code> directory along side the “upstream” source code that we
are simulating here. (More on this later).</p>
</div>
<div class="paragraph">
<p><code>cello.c</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>

<span class="predefined-type">int</span> main(<span class="directive">void</span>) {
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="integer">0</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cello-output-first-patch.patch</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff"><span class="line head"><span class="head">--- </span><span class="filename">cello.c.orig        2016-05-26 17:21:30.478523360 -0500</span></span>
<span class="line head"><span class="head">+++ </span><span class="filename">cello.c     2016-05-27 14:53:20.668588245 -0500</span></span>
<span class="line change"><span class="change">@@</span> -1,6 +1,6 <span class="change">@@</span></span>
 #include&lt;stdio.h&gt;

 int main(void){
<span class="line delete"><span class="delete">-</span>    printf(&quot;Hello World\n&quot;);</span>
<span class="line insert"><span class="insert">+</span>    printf(&quot;Hello World<span class="eyecatcher"> from my very first patch!</span>\n&quot;);</span>
     return 1;
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -o cello cello.c

clean:
        rm cello

install:
        mkdir -p $(DESTDIR)/usr/bin
        install -m 0755 cello $(DESTDIR)/usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s make a project <code>tar.gz</code> out of our source code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/cello-1.0

$ mv ~/cello.c /tmp/cello-1.0/

$ mv ~/Makefile /tmp/cello-1.0/

$ cp /tmp/LICENSE /tmp/cello-1.0/

$ cd /tmp/

$ tar -cvzf cello-1.0.tar.gz cello-1.0
cello-1.0/
cello-1.0/Makefile
cello-1.0/cello.c
cello-1.0/LICENSE

$ mv /tmp/cello-1.0.tar.gz ~/rpmbuild/SOURCES/

$ mv ~/cello-output-first-patch.patch ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Great, now we have all of our upstream source code prep’d and ready to be turned
into RPMs!</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix">Appendix</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here you will find supplementary information that is very good to know and will
likely prove to helpful for anyone who is going to be building RPMs in an
serious capacity but isn’t necessarily a hard requirement to learn how to
package RPMs in the first place which is what the main goal of this document is.</p>
</div>
<div class="sect2">
<h3 id="mock">Mock</h3>
<div class="paragraph">
<p>“ <a href="https://fedoraproject.org/wiki/Mock">Mock</a> is a tool for building packages. It can build packages for different
architectures and different Fedora or RHEL versions than the build host has.
Mock creates chroots and builds packages in them. Its only task is to reliably
populate a chroot and attempt to build a package in that chroot.</p>
</div>
<div class="paragraph">
<p>Mock also offers a multi-package tool, mockchain, that can build chains of
packages that depend on each other.</p>
</div>
<div class="paragraph">
<p>Mock is capable of building SRPMs from source configuration management if the
mock-scm package is present, then building the SRPM into RPMs. See –scm-enable
in the documentation.” (From the upstream documentation)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In order to use <a href="https://fedoraproject.org/wiki/Mock">Mock</a> on a RHEL or CentOS system, you will need to enable
the “Extra Packages for Enterprise Linux” (<a href="https://fedoraproject.org/wiki/EPEL">EPEL</a>) repository. This is
a repository provided by the <a href="https://getfedora.org/">Fedora</a> community and has many useful tools
for RPM Packagers, systems administrators, and developers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One of the most common use cases RPM Packagers have for <a href="https://fedoraproject.org/wiki/Mock">Mock</a> is to create
what is known as a “pristine build environment”. By using mock as a “pristine
build environment”, nothing about the current state of your system has an
effect on the RPM Package itself. Mock uses different configurations to specify
what the build “target” is, these are found on your system in the <code>/etc/mock/</code>
directory (once you’ve installed the <code>mock</code> package). You can build for
different distributions or releases just by specifying it on the command line.
Something to keep in mind is that the configuration files the come with mock are
targeted at Fedora RPM Packagers and as such RHEL and CentOS release versions
are labeled as “epel” because that is the “target” repository these RPMs would
be built for. You simply specify the configuration you want to use (minus the
<code>.cfg</code> file extension). For example, you could build our <code>cello</code> example
for both RHEL 7 and Fedora 23 using the following commands without ever having
to use different machines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mock -r epel-7-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm

$ mock -r fedora-23-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>One example of why you might want to use mock is if you were packaging RPMs on
your laptop and you had a package installed (we’ll call it <code>foo</code> for this
example) that was a <code>BuildRequires</code> of that package you were creating but
forgot to actually make the <code>BuildRequires: foo</code> entry. The build would
succeed when you run <code>rpmbuild</code> because <code>foo</code> was needed to build and it was
found on the system at build time. However, if you took the SRPM to another
system that lacked <code>foo</code> it would fail, causing an unexpected side effect.
<a href="https://fedoraproject.org/wiki/Mock">Mock</a> solves this by first parsing the contents of the SRPM and installing the
<code>BuildRequires</code> into it’s <a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> which means that if you were missing the
<code>BuildRequires</code> entry the build would fail because mock would not know to
install it and it would therefore not be present in the buildroot.</p>
</div>
<div class="paragraph">
<p>Another example is the opposite scenario, let’s say you need <code>gcc</code> to build
a package but don’t have it installed on your system (which is unlikely as a RPM
Packager, but just for the sake of the example let us pretend that is true).
With <a href="https://fedoraproject.org/wiki/Mock">Mock</a>, you don’t have to install <code>gcc</code> on your system because it will
get installed in the chroot as part of mock’s process.</p>
</div>
<div class="paragraph">
<p>Below is an example of attempting to rebuild a package that has a dependency
that I’m missing on my system. The key thing to note is that while <code>gcc</code> is
commonly on most RPM Packager’s systems, some RPM Packages can have over a dozen
<code>BuildRequires</code> and this allows you to not need to clutter up your workstation
with otherwise un-needed or un-necessary packages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
Installing /home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
error: Failed build dependencies: gcc is needed by cello-1.0-1.el7.x86_64

$ mock -r epel-7-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
INFO: mock.py version 1.2.17 starting (python version = 2.7.5)...
Start: init plugins
INFO: selinux enabled
Finish: init plugins
Start: run
INFO: Start(/home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm)  Config(epel-7-x86_64)
Start: clean chroot
Finish: clean chroot
Start: chroot init
INFO: calling preinit hooks
INFO: enabled root cache
Start: unpacking root cache
Finish: unpacking root cache
INFO: enabled yum cache
Start: cleaning yum metadata
Finish: cleaning yum metadata
Mock Version: 1.2.17
INFO: Mock Version: 1.2.17
Start: yum update
base                                                                    | 3.6 kB  00:00:00
epel                                                                    | 4.3 kB  00:00:00
extras                                                                  | 3.4 kB  00:00:00
updates                                                                 | 3.4 kB  00:00:00
No packages marked for update
Finish: yum update
Finish: chroot init
Start: build phase for cello-1.0-1.el7.src.rpm
Start: build setup for cello-1.0-1.el7.src.rpm
warning: Could not canonicalize hostname: rhel7
Building target platforms: x86_64
Building for target x86_64
Wrote: /builddir/build/SRPMS/cello-1.0-1.el7.centos.src.rpm
Getting requirements for cello-1.0-1.el7.centos.src
 --&gt; Already installed : gcc-4.8.5-4.el7.x86_64
 --&gt; Already installed : 1:make-3.82-21.el7.x86_64
No uninstalled build requires
Finish: build setup for cello-1.0-1.el7.src.rpm
Start: rpmbuild cello-1.0-1.el7.src.rpm
Building target platforms: x86_64
Building for target x86_64
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.v9rPOF
+ umask 022
+ cd /builddir/build/BUILD
+ cd /builddir/build/BUILD
+ rm -rf cello-1.0
+ /usr/bin/gzip -dc /builddir/build/SOURCES/cello-1.0.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd cello-1.0
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
Patch #0 (cello-output-first-patch.patch):
+ echo 'Patch #0 (cello-output-first-patch.patch):'
+ /usr/bin/cat /builddir/build/SOURCES/cello-output-first-patch.patch
patching file cello.c
+ /usr/bin/patch -p0 --fuzz=0
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.UxRVtI
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ make -j2
gcc -o cello cello.c
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.K3i2dL
+ umask 022
+ cd /builddir/build/BUILD
+ '[' /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64 '!=' / ']'
+ rm -rf /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
++ dirname /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ mkdir -p /builddir/build/BUILDROOT
+ mkdir /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ cd cello-1.0
+ /usr/bin/make install DESTDIR=/builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
mkdir -p /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin
install -m 0755 cello /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin/cello
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /builddir/build/BUILD/cello-1.0
extracting debug info from /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin/cello
dwz: Too few files for multifile optimization
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 1 CRC32s did match.
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: cello-1.0-1.el7.centos.x86_64
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.vxtAuO
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ LICENSEDIR=/builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ export LICENSEDIR
+ /usr/bin/mkdir -p /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ cp -pr LICENSE /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ exit 0
Provides: cello = 1.0-1.el7.centos cello(x86-64) = 1.0-1.el7.centos
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: libc.so.6()(64bit) libc.so.6(GLIBC_2.2.5)(64bit) rtld(GNU_HASH)
Processing files: cello-debuginfo-1.0-1.el7.centos.x86_64
Provides: cello-debuginfo = 1.0-1.el7.centos cello-debuginfo(x86-64) = 1.0-1.el7.centos
Requires(rpmlib): rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1 rpmlib(CompressedFileNames) &lt;= 3.0.4-1
Checking for unpackaged file(s): /usr/lib/rpm/check-files /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
Wrote: /builddir/build/RPMS/cello-1.0-1.el7.centos.x86_64.rpm
warning: Could not canonicalize hostname: rhel7
Wrote: /builddir/build/RPMS/cello-debuginfo-1.0-1.el7.centos.x86_64.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.JuPOtY
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ /usr/bin/rm -rf /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ exit 0
Finish: rpmbuild cello-1.0-1.el7.src.rpm
Finish: build phase for cello-1.0-1.el7.src.rpm
INFO: Done(/home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm) Config(epel-7-x86_64) 0 minutes 16 seconds
INFO: Results and/or logs in: /var/lib/mock/epel-7-x86_64/result
Finish: run</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, mock is a fairly verbose tool. You will also notice a lot of
<a href="http://yum.baseurl.org/">yum</a> or <a href="https://github.com/rpm-software-management/dnf">dnf</a> output (depending on RHEL7, CentOS7, or Fedora mock target)
that is not found in this output which was omitted for brevity and is often
omitted after you have done an <code>--init</code> on a mock target, such as
<code>mock -r epel-7-x86_64 --init</code> which will pre-download all the
required packages, cache them, and pre-stage the build chroot.</p>
</div>
<div class="paragraph">
<p>For more information, please consult the <a href="https://fedoraproject.org/wiki/Mock">Mock</a> upstream documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="version-control-systems">Version Control Systems</h3>
<div class="paragraph">
<p>When working with RPMs, it is often desireable to utilize a <a href="https://en.wikipedia.org/wiki/Version_control">Version Control
System</a> (VCS) such as <a href="https://git-scm.com/">git</a> for managing components of the software we are
packaging. Something to note is that storing binary files in a VCS is not
favorable because it will drastically inflate the size of the source repository
as these tools are engineered to handle differentials in files (often optimized
for text files) and this is not something that binary files lend themselves to
so normally each whole binary file is stored. As a side effect of this there are
some clever utilities that are popular among upstream Open Source projects that
work around this problem by either storing the SPEC file where the source code
is in a VCS (i.e. - it is not in a compressed archive for redistribution) or
place only the SPEC file and patches in the VCS and upload the compressed
archive of the upstream release source to what is called a “look aside cache”.</p>
</div>
<div class="paragraph">
<p>In this section we will cover two different options for using a VCS system,
<a href="https://git-scm.com/">git</a>, for managing the contents that will ultimately be turned into a RPM
package. One is called <a href="https://github.com/dgoodwin/tito">tito</a> and the other is <a href="https://github.com/release-engineering/dist-git">dist-git</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For the duration of this section you will need to install the <code>git</code>
package on you system in order to follow along.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tito">tito</h4>
<div class="paragraph">
<p>Tito is an utility that assumes all the source code for the software that is
going to be packaged is already in a <a href="https://git-scm.com/">git</a> source control repository. This is
good for those practicing a DevOps workflow as it allows for the team writing
the software to maintain their normal <a href="https://git-scm.com/book/en/v2/Git-Branching-Branching-Workflows">Branching Workflow</a>. Tito will then
allow for the software to be incrementally packaged, built in an automated
fashion, and still provide a native installation experience for <a href="http://rpm.org/">RPM</a> based
systems.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <a href="https://github.com/dgoodwin/tito">tito</a> package is available in <a href="https://getfedora.org/">Fedora</a> as well as in the <a href="https://fedoraproject.org/wiki/EPEL">EPEL</a>
repository for use on RHEL 7 and CentOS 7.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tito operates based on <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging">git tags</a> and will manage tags for you if you elect to
allow it, but can optionally operate under whatever tagging scheme you prefer as
this functionality is configurable.</p>
</div>
<div class="paragraph">
<p>Let’s explore a little bit about tito by looking at an upstream project already
using it. We will actually be using the upstream git repository of the project
that is our next section’s subject, <a href="https://github.com/release-engineering/dist-git">dist-git</a>. Since this project is publicly
hosted on is publicly hosted on <a href="https://github.com/">GitHub</a>, let’s go ahead and clone the git
repo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git clone https://github.com/release-engineering/dist-git.git
Cloning into 'dist-git'...
remote: Counting objects: 425, done.
remote: Total 425 (delta 0), reused 0 (delta 0), pack-reused 425
Receiving objects: 100% (425/425), 268.76 KiB | 0 bytes/s, done.
Resolving deltas: 100% (184/184), done.
Checking connectivity... done.

$ cd dist-git/

$ ls *.spec
dist-git.spec

$ tree rel-eng/
rel-eng/
├── packages
│   └── dist-git
└── tito.props

1 directory, 2 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see here, the SPEC file is at the root of the git repository and there
is a <code>rel-eng</code> directory in the repository which is used by tito for general
book keeping, configuration, and various advanced topics like custom tito
modules. We can see in the directory layout that there is a sub-directory
entitled <code>packages</code> which will store a file per package that tito manages in
the repository as you can have many RPMs in a single git repository and tito
will handle that just fine. In this scenario however, we see only a single
package listing and it should be noted that it matches the name of our SPEC
file. All of this is setup by the command <code>tito init</code> when the developers of
<a href="https://github.com/release-engineering/dist-git">dist-git</a> first initialized their git repo to be managed by tito.</p>
</div>
<div class="paragraph">
<p>If we were to follow a common workflow of a DevOps Practitioner then we would
likely want to use this as part of a <a href="https://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration</a> (CI) or
<a href="https://en.wikipedia.org/wiki/Continuous_delivery">Continuous Delivery</a> (CD) process. What we can do in that scenario is perform
what is known as a “test build” to tito, we can even use mock to do this. We
could then use the output as the installation point for some other component in
the pipeline. Below is a simple example of commands that could accomplish this
and they could be adapted to other environments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ tito build --test --srpm
Building package [dist-git-0.13-1]
Wrote: /tmp/tito/dist-git-git-0.efa5ab8.tar.gz

Wrote: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm

$ tito build --builder=mock --arg mock=epel-7-x86_64 --test --rpm
Building package [dist-git-0.13-1]
Creating rpms for dist-git-git-0.efa5ab8 in mock: epel-7-x86_64
Wrote: /tmp/tito/dist-git-git-0.efa5ab8.tar.gz

Wrote: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm

Using srpm: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm
Initializing mock...
Installing deps in mock...
Building RPMs in mock...
Wrote:
  /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm
  /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm

$ sudo yum localinstall /tmp/tito/dist-git-*.noarch.rpm
Loaded plugins: product-id, search-disabled-repos, subscription-manager
Examining /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm: dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch
Marking /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm to be installed
Examining /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm: dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch
Marking /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm to be installed
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package dist-git.noarch 0:0.13-1.git.0.efa5ab8.el7.centos will be installed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the final command would need to be run with either sudo or root
permissions and that much of the output has been omitted for brevity as the
dependency list is quite long.</p>
</div>
<div class="paragraph">
<p>This concludes our simple example of how to use tito but it has many amazing
features for traditional Systems Administrators, RPM Packagers, and DevOps
Practitioners alike. I would highly recommend consulting the upstream
documentation found at the <em>tito</em> GitHub site for more information on how to
quickly get started using it for your project as well as various advanced
features it offers.</p>
</div>
</div>
<div class="sect3">
<h4 id="dist-git">dist-git</h4>
<div class="paragraph">
<p>The <a href="https://github.com/release-engineering/dist-git">dist-git</a> utility takes a slightly different approach from that of <a href="https://github.com/dgoodwin/tito">tito</a>
such that instead of keeping the raw source code in <a href="https://git-scm.com/">git</a> it instead will keep
SPEC files and patches in a git repository and upload the compressed archive of
the source code to what is known as a “look-aside cache”. The “look-aside-cache”
is a term that was coined by the use of RPM Build Systems storing large files
like these “on the side”. A system like this is generally tied to a proper RPM
Build System such as <a href="https://fedorahosted.org/koji/">Koji</a>. The build system is then configured to pull the
items that are listed as <code>SourceX</code> entries in the SPEC files in from this
look-aside-cache, while the SPEC and patches remain in a version control system.
There is also a helper command line tool to assist in this.</p>
</div>
<div class="paragraph">
<p>In an effort to not duplicate documentation, for more information on how to
setup a system such as this please refer to the upstream <a href="https://github.com/release-engineering/dist-git">dist-git</a> docs.
upstream docs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="more-on-macros">More on Macros</h3>
<div class="paragraph">
<p>There are many built-in RPM Macros and we will cover a few in the following
section, however an exhaustive list can be found rpm.org’s <a href="http://rpm.org/wiki/PackagerDocs/Macros">rpm macro</a> official
documentation.</p>
</div>
<div class="paragraph">
<p>There are also macros that are provided by your <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> Distribution, we will
cover some of those provided by <a href="https://getfedora.org/">Fedora</a>, <a href="https://www.centos.org/">CentOS</a> and <a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a> in this section
as well as provide information on how to inspect your system to learn about
others that we don’t cover or for discovering them on other RPM-based <a href="https://en.wikipedia.org/wiki/Linux">Linux</a>
Distributions.</p>
</div>
<div class="sect3">
<h4 id="defining-your-own">Defining Your Own</h4>
<div class="paragraph">
<p>You can define your own Macros, below is an excerpt from the <a href="http://rpm.org/wiki/Docs">RPM Official
Documentation</a> and I recommend anyone interested in an exhaustive explanation
of the many possibilities of defining their own macros to visit that resource.
It’s really quite good and there’s little reason to duplicate the bulk of that
content here.</p>
</div>
<div class="paragraph">
<p>To define a macro use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%define &lt;name&gt;[(opts)]</code></pre>
</div>
</div>
<div class="paragraph">
<p>All whitespace surrounding <code>\</code> is removed.  Name may be composed
of alphanumeric characters, and the character <code>_</code> and must be at least
3 characters in length. A macro without an (opts) field is “simple” in that
only recursive macro expansion is performed. A parameterized macro contains
an (opts) field. The opts (i.e. string between parentheses) is passed
exactly as is to getopt(3) for argc/argv processing at the beginning of
a macro invocation.</p>
</div>
</div>
<div class="sect3">
<h4 id="files">%files</h4>
<div class="paragraph">
<p>Common “advanced” RPM Macros needed in the <code>%files</code> section are as follows:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Macro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This identifies the file listed as a LICENSE file and it
will be installed and labeled as such by RPM.
Example: <code>%license LICENSE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%doc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This identifies the file listed as documentation and it
will be installed and labeled as such by RPM. This is often
used not only for documentation about the software being
packaged but also code examples and various items that
should accompany documentation. In the event code examples
are included, care should be taken to remove executable
mode from the file.
Example: <code>%doc README</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies that the path is a directory that should be owned
by this RPM. This is important so that the rpm file manifest
accurately knows what directories to clean up on uninstall.
Example: <code>%dir %{_libdir}/%{name}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%config(noreplace)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the following file is a configuration file
and therefore should not be overwritten (or replaced) on
a package install or update if the file has been modified
from the original installation checksum. In the event that
there is a change, the file will be created with <code>.rpmnew</code>
appended to the end of the filename upon upgrade or install
so that the pre-existing or modified file on the target
system is not modified.
Example: <code>%config(noreplace)
%{_sysconfdir}/%{name}/%{name}.conf</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="built-in-macros">Built In Macros</h4>
<div class="paragraph">
<p>Your system has many built in RPM Macros and the fastest way to view them all is
to simply run the <code>rpm --showrc</code> command, however note that this will contain
a <em>lot</em> of output so it’s often used in combination with a pipe to grep (or
a clever shell Process Substitution).</p>
</div>
<div class="paragraph">
<p>You can also find information about the RPMs macros that come directly with your
system’s version of RPM by looking at the output of the command <code>rpm -ql rpm</code>
taking note of the files titled <code>macros</code> in the directory structure.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-distribution-macros">RPM Distribution Macros</h4>
<div class="paragraph">
<p>Different distributions will supply different sets of recommended RPM Macros
based on the language implementation of the software being packaged or the
specific Guidelines of the distribution in question.</p>
</div>
<div class="paragraph">
<p>These are often provided as RPM Packages themselves and can be installed with
the distribution package manager, such as <a href="http://yum.baseurl.org/">yum</a> or <a href="https://github.com/rpm-software-management/dnf">dnf</a>. The macro files
themselves once installed can be found in <code>/usr/lib/rpm/macros.d/</code> and will be
included in the <code>rpm --showrc</code> output by default once installed.</p>
</div>
<div class="paragraph">
<p>One primary example of this is the <a href="https://fedoraproject.org/wiki/Packaging:Guidelines?rd=Packaging/Guidelines">Fedora Packaging Guidelines</a> section
pertaining specifically to <a href="https://fedoraproject.org/wiki/Packaging:Guidelines#Application_Specific_Guidelines">Application Specific Guidelines</a> which at the time
of this writing has over 30 different sets of guidelines along with associated
RPM Macro sets for subject matter specific RPM Packaging.</p>
</div>
<div class="paragraph">
<p>One example of these kinds of RPMs would be for <a href="https://www.python.org/">Python</a> version 2.x and if we
have the <code>python2-rpm-macros</code> package installed (available in EPEL for RHEL
7 and CentOS 7), we have a number of python2 specific macros available to us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ql python2-rpm-macros
/usr/lib/rpm/macros.d/macros.python2

$ rpm --showrc | grep python2
-14: __python2  /usr/bin/python2
CFLAGS=&quot;%{optflags}&quot; %{__python2} %{py_setup} %{?py_setup_args} build --executable=&quot;%{__python2} %{py2_shbang_opts}&quot; %{?1}
CFLAGS=&quot;%{optflags}&quot; %{__python2} %{py_setup} %{?py_setup_args} install -O1 --skip-build --root %{buildroot} %{?1}
-14: python2_sitearch   %(%{__python2} -c &quot;from distutils.sysconfig import get_python_lib; print(get_python_lib(1))&quot;)
-14: python2_sitelib    %(%{__python2} -c &quot;from distutils.sysconfig import get_python_lib; print(get_python_lib())&quot;)
-14: python2_version    %(%{__python2} -c &quot;import sys; sys.stdout.write('{0.major}.{0.minor}'.format(sys.version_info))&quot;)
-14: python2_version_nodots     %(%{__python2} -c &quot;import sys; sys.stdout.write('{0.major}{0.minor}'.format(sys.version_info))&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above output displays the raw RPM Macro definitions, but we are likely more
interested in what these will evaluate to which we can do with <code>rpm --eval</code> in
order to determine what they do as well as how they may be helpful to us when
packaging RPMs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --eval %{__python2}
/usr/bin/python2

$ rpm --eval %{python2_sitearch}
/usr/lib64/python2.7/site-packages

$ rpm --eval %{python2_sitelib}
/usr/lib/python2.7/site-packages

$ rpm --eval %{python2_version}
2.7

$ rpm --eval %{python2_version_nodots}
27</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-spec-file-topics">Advanced SPEC File Topics</h3>
<div class="paragraph">
<p>There are various topics in the world of RPM SPEC Files that are considered
advanced because they have implications on not only the SPEC file, how the
package is built, but also on the end machine that the resulting RPM is
installed upon. In this section we will cover the most common of these such as
Epoch, Scriptlets, and Triggers.</p>
</div>
<div class="sect3">
<h4 id="epoch">Epoch</h4>
<div class="paragraph">
<p>First on the list is <code>Epoch</code>, epoch is a way to define weighted dependencies
based on version numbers. It’s default value is 0 and this is assumed if an
<code>Epoch</code> directive is not listed in the RPM SPEC file. This was not covered in
the SPEC File section of this guide because it is almost always a bad idea to
introduce an Epoch value as it will skew what you would normally otherwise
expect RPM to do when comparing versions of packages.</p>
</div>
<div class="paragraph">
<p>For example if a package <code>foobar</code> with <code>Epoch: 1</code> and <code>Version: 1.0</code> was
installed and someone else packaged <code>foobar</code> with <code>Version: 2.0</code> but simply
omitted the <code>Epoch</code> directive either because they were unaware of it’s
necessity or simply forgot, that new version would never be considered an update
because the Epoch version would win out over the traditional
Name-Version-Release marker that signifies versioning for RPM Packages.</p>
</div>
<div class="paragraph">
<p>This approach is generally only used when absolutely necessary (as a last
resort) to resolve an upgrade ordering issue which can come up as a side effect
of upstream software changing versioning number schemes or versions
incorporating alphabetical characters that can not always be compared reliably
based on encoding.</p>
</div>
</div>
<div class="sect3">
<h4 id="triggers-and-scriptlets">Triggers and Scriptlets</h4>
<div class="paragraph">
<p>In RPM Packages, there are a series of directives that can be used to inflict
necessary or desired change on a system during install time of the RPM. These
are called <strong>scriptlets</strong>.</p>
</div>
<div class="paragraph">
<p>One primary example of when and why you’d want to do this is when a system
service RPM is installed and it provides a <a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a> <a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">unit file</a>. At install
time we will need to notify <a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a> that there is a new unit so that the
system administrator can run a command similar to <code>systemctl start
foo.service</code> after the fictional RPM <code>foo</code> (which provides some service
daemon in this example) has been installed. Similarly, we would need to inverse
of this action upon uninstallation so that an administrator would not get errors
due to the daemon’s binary no longer being installed but the unit file still
existing in systemd’s running configuration.</p>
</div>
<div class="paragraph">
<p>There are a small handful of common scriptlet directives, they are similar to
the “section headers” like <code>%build</code> or <code>%install</code> in that they are defined
by multi-line segments of code, often written as standard <a href="https://en.wikipedia.org/wiki/POSIX">POSIX</a> shell script
but can be a few different programming languages such that RPM for the target
machine’s distribution is configured to allow them. An exhaustive list of these
available languages can be found in the <em>RPM Official Documentation</em>.</p>
</div>
<div class="paragraph">
<p>Scriptlet directives are as follows:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scriptlet that is executed just before the package is
installed on the target system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%post</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scriptlet that is executed just after the package is
installed on the target system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%preun</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scriptlet that is executed just before the package is
uninstalled from the target system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%postun</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scriptlet that is executed just after the package is
uninstalled from the target system.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Is is also common for RPM Macros to exist for this function. In our previous
example we discussed <a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a> needing to be notified about a new <a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">unit file</a>,
this is easily handled by the systemd scriptlet macros as we can see from the
below example output. More information on this can be found in the <a href="https://fedoraproject.org/wiki/Packaging:Systemd">Fedora
systemd Packaging Guidelines</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --showrc | grep systemd
-14: __transaction_systemd_inhibit      %{__plugindir}/systemd_inhibit.so
-14: _journalcatalogdir /usr/lib/systemd/catalog
-14: _presetdir /usr/lib/systemd/system-preset
-14: _unitdir   /usr/lib/systemd/system
-14: _userunitdir       /usr/lib/systemd/user
/usr/lib/systemd/systemd-binfmt %{?*} &gt;/dev/null 2&gt;&amp;1 || :
/usr/lib/systemd/systemd-sysctl %{?*} &gt;/dev/null 2&gt;&amp;1 || :
-14: systemd_post
-14: systemd_postun
-14: systemd_postun_with_restart
-14: systemd_preun
-14: systemd_requires
Requires(post): systemd
Requires(preun): systemd
Requires(postun): systemd
-14: systemd_user_post  %systemd_post --user --global %{?*}
-14: systemd_user_postun        %{nil}
-14: systemd_user_postun_with_restart   %{nil}
-14: systemd_user_preun
systemd-sysusers %{?*} &gt;/dev/null 2&gt;&amp;1 || :
echo %{?*} | systemd-sysusers - &gt;/dev/null 2&gt;&amp;1 || :
systemd-tmpfiles --create %{?*} &gt;/dev/null 2&gt;&amp;1 || :

$ rpm --eval %{systemd_post}

if [ $1 -eq 1 ] ; then
        # Initial installation
        systemctl preset  &gt;/dev/null 2&gt;&amp;1 || :
fi

$ rpm --eval %{systemd_postun}

systemctl daemon-reload &gt;/dev/null 2&gt;&amp;1 || :

$ rpm --eval %{systemd_preun}

if [ $1 -eq 0 ] ; then
        # Package removal, not upgrade
        systemctl --no-reload disable  &gt; /dev/null 2&gt;&amp;1 || :
        systemctl stop  &gt; /dev/null 2&gt;&amp;1 || :
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another item that provides even more fine grained control over the RPM
Transaction as a whole is what is known as <strong>triggers</strong>. These are effectively
the same thing as a scriptlet but are executed in a very specific order of
operations during the RPM install or upgrade transaction allowing for a more
fine grained control over the entire process.</p>
</div>
<div class="paragraph">
<p>The order in which each is executed and the details of which are provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">all-%pretrans
...
any-%triggerprein (%triggerprein from other packages set off by new install)
new-%triggerprein
new-%pre      for new version of package being installed
...           (all new files are installed)
new-%post     for new version of package being installed

any-%triggerin (%triggerin from other packages set off by new install)
new-%triggerin
old-%triggerun
any-%triggerun (%triggerun from other packages set off by old uninstall)

old-%preun    for old version of package being removed
...           (all old files are removed)
old-%postun   for old version of package being removed

old-%triggerpostun
any-%triggerpostun (%triggerpostun from other packages set off by old un
            install)
...
all-%posttrans</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above items are from the included RPM documentation found in
<code>/usr/share/doc/rpm/triggers</code> on Fedora systems and
<code>/usr/share/doc/rpm-4.*/triggers</code> on RHEL 7 and CentOS 7 systems.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="references">References</h3>
<div class="paragraph">
<p>Below are references to various topics of interest around RPMs, RPM Packaging,
and RPM Building. Some of these will be advanced and extend far beyond the
introductory material included in this guide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://rpm.org/wiki/Docs">RPM Official Documentation</a></p>
</li>
<li>
<p><a href="https://www.gurulabs.com/media/files/courseware-samples/GURULABS-RPM-GUIDE-v1.0.PDF">Gurulabs CREATING RPMS (Student Version)</a></p>
</li>
<li>
<p><a href="https://fedoraproject.org/wiki/How_to_create_an_RPM_package">Fedora How To Create An RPM Package Guide</a></p>
</li>
<li>
<p><a href="https://fedoraproject.org/wiki/Packaging:Guidelines?rd=Packaging/Guidelines">Fedora Packaging Guidelines</a></p>
</li>
<li>
<p><a href="https://en.opensuse.org/openSUSE:Packaging_guidelines">OpenSUSE Packaging Guidelines</a></p>
</li>
<li>
<p>IBM RPM Packaging Guide: <a href="http://www.ibm.com/developerworks/library/l-rpm1/">Part 1</a>, <a href="http://www.ibm.com/developerworks/library/l-rpm2/">Part 2</a>, <a href="http://www.ibm.com/developerworks/library/l-rpm3/">Part 3</a></p>
</li>
<li>
<p><em>Maximum RPM</em> (Some material is dated, but this is still a great resource for
advanced topics.)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-02-21 19:12:03 CET
</div>
</div>
</body>
</html>